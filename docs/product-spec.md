# Tempo AI プロダクト仕様書

**バージョン**: 4.2
**最終更新日**: 2025 年 12 月 19 日
**ステータス**: MVP 開発準備中（コンディション画面リニューアル版）

---

## 目次

1. [プロダクト概要](#1-プロダクト概要)
2. [機能要件](#2-機能要件)
3. [コンディション画面](#3-コンディション画面)
4. [データ要件](#4-データ要件)
5. [ユーザープロフィール設計](#5-ユーザープロフィール設計)
6. [オンボーディングフロー](#6-オンボーディングフロー)
7. [アドバイス生成ロジック](#7-アドバイス生成ロジック)
8. [エラーハンドリング](#8-エラーハンドリング)
9. [プライバシー・セキュリティ](#9-プライバシーセキュリティ)
10. [MVP スコープ](#10-mvpスコープ)
11. [関連ドキュメント](#11-関連ドキュメント)

---

## 1. プロダクト概要

### 1.1 プロダクト名

**Tempo AI**（英語表記）

### 1.2 コンセプト

「自分のテンポで、健やかな毎日を」

Tempo AI は、ユーザーの生体リズム・活動量・回復速度などのヘルスケアデータと、気象・環境データを組み合わせて AI が分析し、**その日の過ごし方**をパーソナライズしてアドバイスするヘルスケアアプリです。

「テンポ」とは、その人固有の生体リズム、活動量の変動パターン、HRV（心拍変動）に表れる自律神経の状態、サーカディアンリズムなどを指します。静的な健康スコアではなく、「今日のあなたに合った過ごし方」を毎朝提案することで、ユーザーが自分のペースで健康を推進できるようサポートします。

#### 1.2.1 核心コンセプト: 自律神経バランスとサーカディアンリズム

Tempo AI の健康メトリクス体系は、**自律神経バランス**と**サーカディアンリズム**を核心として設計されています。

| 核心概念             | 説明                               | 対応メトリクス |
| -------------------- | ---------------------------------- | -------------- |
| 自律神経バランス     | 交感神経と副交感神経のバランス状態 | HRV            |
| サーカディアンリズム | 体内時計の安定性と規則性           | リズム、睡眠   |
| 身体活動             | 日中の活動量と回復の関係           | 活動量         |

これらのメトリクスは相互に関連し、総合的なウェルビーイングを構成します。詳細なアルゴリズムは [metrics-algorithm-spec.md](./metrics-algorithm-spec.md) を参照。

### 1.3 ターゲットユーザー

- **属性**: 年齢層・性別は問わない
- **特徴**:
  - 健康意識があり、ヘルスケアを管理したいと考えている
  - データに基づいたヘルスケア解析に興味がある
  - 何らかの不調を抱えている、またはパフォーマンスを向上させたい
  - 日常的にリラックス・チルしたい
- **前提**: Apple Watch または iPhone でヘルスケアデータを記録している

### 1.4 解決する課題

- 健康データはあるが、どう活かせばいいかわからない
- 毎日の体調に合わせた具体的な行動指針がほしい
- 一般的な健康アドバイスではなく、自分に合ったパーソナライズされた情報がほしい
- 天気や環境の変化が体調に与える影響を理解したい

### 1.5 重要な制約

**医学的なアドバイス・診断は絶対に行わない**

Tempo AI は健康的なライフスタイルをサポートするためのウェルネスアプリであり、医療行為・医学的診断・治療の代替となるものではありません。

---

## 2. 機能要件

### 2.1 画面構成

| タブ           | 役割                         |
| -------------- | ---------------------------- |
| ホーム         | 今日のアドバイス、トライ提案 |
| コンディション | 健康状態のダッシュボード     |
| 設定           | プロフィール編集、各種設定   |

### 2.2 メインアドバイス機能

#### 2.2.1 概要

毎日 1 回、ユーザーがアプリを開いたときに、その日のパーソナライズされたアドバイスを生成・表示します。

#### 2.2.2 生成タイミング

| 条件                     | 動作                                                          |
| ------------------------ | ------------------------------------------------------------- |
| その日初めてアプリを起動 | アドバイスを新規生成                                          |
| 同日中に再度起動         | 生成済みのアドバイスを表示（再生成しない）                    |
| 時間制限                 | なし（23 時に開いても「今日のアドバイス」として生成）         |
| オフライン時             | 「最新情報を取得できません」メッセージ + 前日のアドバイス表示 |
| 初回起動時               | オンボーディング完了直後にアドバイス生成                      |

#### 2.2.3 アドバイスの構成要素

| セクション               | 内容                                                                 | 長さ目安 |
| ------------------------ | -------------------------------------------------------------------- | -------- |
| 挨拶                     | 「〇〇さん、おはようございます」                                     | 1 文     |
| 今日のコンディション概要 | 睡眠・HRV・気象のサマリー（ホーム画面表示用）                        | 3-4 文   |
| 今日のコンディション詳細 | 睡眠・HRV・活動量・気象の詳細分析 + 具体的な行動提案を自然に織り込む | 8-12 文  |
| 今日のトライ             | 1 日 1 つの新しいチャレンジ提案（なぜ今日これなのかを含む）          | 5-7 文   |
| お見送りメッセージ       | 温かい締めの一言                                                     | 1-2 文   |

**注意**: 以前の「具体的な行動提案」セクション（action_suggestions）は削除され、コンディション詳細の中に自然に織り込む形式に変更されました。

#### 2.2.4 アドバイスのパーソナライズ要素

- ユーザーのニックネームを使用した呼びかけ
- 職業に基づいた具体的なアドバイス（例：デスクワーカーへの目の疲れ対策）
- 関心ごとタグに基づいた内容の重み付け（1-3 個のタグを動的に反映）
- 過去 7 日間・30 日間のトレンドとの比較
- 気象・大気汚染データとの掛け合わせ
- ユーザー固有の相関データ（十分なデータがある場合）

---

### 2.3 今日のトライ機能

#### 2.3.1 概要

メインアドバイスの一部として、1 日 1 つの新しいチャレンジを提案します。

#### 2.3.2 特徴

| 項目           | 内容                                   |
| -------------- | -------------------------------------- |
| 難易度         | 低（5-15 分で完結、今夜試せるレベル）  |
| 必要なもの     | 家にあるもの、または何も不要           |
| 多様性         | 過去 2 週間で提案していないもの        |
| 関心ごと反映率 | 70-80%                                 |
| パーソナライズ | 「なぜ今日これなのか」の理由を必ず明示 |

#### 2.3.3 選定ロジック

1. **当日のメトリクススコア**から「今日の課題」を特定（最もスコアが低いメトリクス）
2. **ユーザーの関心タグ**でフィルタリング（70-80%反映）
3. **過去 2 週間の履歴**と重複しないものを選択
4. **相関データ**があれば「あなたの場合」として活用
5. 「なぜ今日これなのか」の理由を必ず明示

#### 2.3.4 カテゴリー例

- ボディケア（マッサージ、ストレッチなど）
- メンタルケア（呼吸法、瞑想など）
- 栄養（特定の食材を取り入れるなど）
- 運動（軽いウォーキング、ルート変更など）
- 睡眠準備（デジタルデトックス、入浴法など）
- マインドフルネス（感謝日記、自然観察など）

---

### 2.4 関心ごとタグ機能

#### 2.4.1 概要

ユーザーの関心事に基づいてアドバイスをパーソナライズします。

#### 2.4.2 タグカテゴリー（6 種類）

1. **エネルギー・パフォーマンス**
2. **栄養・食事**
3. **運動・フィットネス**
4. **メンタル・ストレス**
5. **美容・スキンケア**
6. **睡眠**

#### 2.4.3 選択ルール

| 項目           | 内容                         |
| -------------- | ---------------------------- |
| 選択数         | 1〜3 個（必須: 最低 1 個）   |
| 設定タイミング | 初回オンボーディング時       |
| 変更           | 設定画面からいつでも変更可能 |

#### 2.4.4 アドバイスへの影響範囲

| アドバイス種別     | 関心ごと反映率 |
| ------------------ | -------------- |
| コンディション詳細 | 30-40%         |
| 今日のトライ       | 70-80%         |

---

## 3. コンディション画面

### 3.1 概要

> **「今日のコンディションと、なぜその状態なのかを直感的に理解する」**

コンディション画面は、サーカディアンリズムと自律神経（HRV）を軸に、ユーザーの体調とその要因を可視化するダッシュボードです。

**設計思想:**
- HRVを「今日のコンディションの結果指標」として中心に配置
- 睡眠・リズム・環境・活動を「要因」として構造化
- AIが複数の要因を統合して因果関係を言語化

**従来との違い:**
- 4つの小カード → 要因マップに統合
- 5つの詳細画面 → 1つの詳細画面に統合
- ストレスメトリクス → 削除（HRVに統合）

### 3.2 コンディショントップ画面の構成

#### 3.2.1 画面構成要素

| 要素 | 内容 | 役割 |
|------|------|------|
| 24時間サークル図 + HRV | サークル中央にHRV値を表示 | リズムと自律神経の関係を視覚化 |
| リズム安定度 | ステータス + インジケーター + 説明文 | リズムが「土台」であることを強調 |
| 要因マップ | 睡眠・環境・活動の3要因 | コンディションの因果関係を可視化 |
| AIの見立て | 3-5文の統合解釈 | 因果関係を言語化 |

#### 3.2.2 24時間サークル図 + HRV統合表示

| 要素 | 内容 |
|------|------|
| 外周 | 過去7日間の就寝・起床時刻をプロット |
| 睡眠帯 | 昨夜の睡眠時間を塗りつぶしで表示 |
| 中央上部 | HRV値（ms）を大きく表示 |
| 中央下部 | 7日平均との差分（▲+9% など） |
| 下部テキスト | 昨夜の就寝時刻・今朝の起床時刻 |

**視覚的メタファー**: 外側のサークル（リズム）が整っていると、中心（HRV/自律神経）も安定するという関係性を表現。

#### 3.2.3 リズム安定度表示

| 要素 | 内容 |
|------|------|
| ステータス | 良好 / やや不安定 / 不安定 |
| インジケーター | ●●●○○ のような5段階表示 |
| 説明文 | 「3日連続で安定 → 回復効率アップ中」など |

**生成ロジック（条件分岐）:**

| 条件 | ステータス | 説明文 |
|------|-----------|--------|
| リズムスコア≥70 かつ 3日以上連続安定 | 良好 | 「{N}日連続で安定 → 回復効率アップ中」 |
| リズムスコア≥70 かつ 連続2日以下 | 良好 | 「リズムが整っています」 |
| リズムスコア 50-69 | やや不安定 | 「就寝時刻にばらつきがあります」 |
| リズムスコア<50 | 不安定 | 「リズムの乱れが回復を妨げています」 |

※ 「連続安定」の判定: 過去N日間のリズムスコアがすべて70以上

#### 3.2.4 要因マップ

HRV（コンディション）に影響を与える3つの要因を表示。

| 要因 | データソース | 表示内容 |
|------|-------------|----------|
| 睡眠 | HealthKit | 睡眠時間、深い睡眠時間、貢献度 |
| 環境 | Open-Meteo | 気圧、気温、負荷度 |
| 活動 | HealthKit | 前日の歩数、活動レベル |

**貢献度・負荷度の表現:**

| レベル | 表示テキスト | プログレスバー |
|--------|-------------|---------------|
| 高プラス | 回復に大きく貢献 | ████████░░ |
| プラス | 回復に貢献 | ██████░░░░ |
| 中立 | 影響少なめ | ████░░░░░░ |
| マイナス | やや負荷あり | ██░░░░░░░░ |
| 高マイナス | 負荷あり | █░░░░░░░░░ |

※ 算出ロジックの詳細は [metrics-spec.md](./metrics-spec.md) セクション10を参照

#### 3.2.5 AIの見立て

Claude APIが生成する3-5文の統合解釈。要因マップの情報を総合し、「なぜ今日この状態なのか」を言語化する。

| 項目 | 内容 |
|------|------|
| 生成タイミング | 1日1回（ホーム画面のアドバイスと同時） |
| 文量 | 3-5文 |
| 内容 | HRVの状態、リズムの影響、環境の影響、今日の過ごし方の示唆 |

※ AIプロンプトの詳細は [spec.md](./ai-prompts/spec.md) を参照

### 3.3 詳細画面

「詳しく見る」をタップした際に表示される画面。従来の5画面を1画面に統合。

#### 3.3.1 画面構成

| セクション | 内容 | 表示条件 |
|-----------|------|----------|
| あなたのパターン | 散布図 + インサイト文 | 2週間以上のデータ蓄積後 |
| リズムを整えるヒント | 条件分岐による定型文（最大2つ） | 常時表示 |

#### 3.3.2 「あなたのパターン」セクション

**散布図の仕様:**

| 項目 | 内容 |
|------|------|
| 縦軸 | 翌朝のHRV（ms） |
| 横軸 | 前日の睡眠時間（時間） |
| データ点 | 過去30日分 |
| 参照線 | 閾値（例: 7時間）を点線で表示 |

**インサイト文の生成:**

分析対象のパターン（優先順位順）:

| 優先度 | パターン | 閾値 |
|--------|----------|------|
| 1 | 睡眠時間 → HRV | 7時間 |
| 2 | 就寝時刻 → HRV | 23:30 |
| 3 | 歩数 → 深い睡眠 | 6,000歩 |

最も差が大きいパターン1つを表示。差が10%未満の場合は「まだパターンを分析中です」と表示。

※ 算出ロジックの詳細は [metrics-spec.md](./metrics-spec.md) セクション11を参照

#### 3.3.3 「リズムを整えるヒント」セクション

データに基づいて定型文を条件分岐で表示（AIは使用しない）。最大2つまで表示。

| 条件 | 表示するヒント |
|------|----------------|
| 就寝時刻のばらつきが大きい (SD > 60分) | 「毎日同じ時間に寝ることを目指しましょう」 |
| 起床時刻が遅い (平均 > 8:00) | 「起床時刻を少しずつ早めて、朝の光を浴びましょう」 |
| 週末シフトあり (平日と2時間以上差) | 「週末も平日と同じ時間に起きる習慣をつけましょう」 |
| 就寝が遅い (平均 > 24:00) | 「就寝を毎日15-30分ずつ早めてみましょう」 |
| 特に問題なし | 「このリズムを維持できると良いですね」 |

---

## 4. データ要件

### 4.1 HealthKit 取得データ

#### 4.1.1 必須データ

| データ種別   | HKObjectType                              | 用途                     |
| ------------ | ----------------------------------------- | ------------------------ |
| 心拍数       | HKQuantityType(.heartRate)                | HRV スコア、安静時心拍数 |
| HRV          | HKQuantityType(.heartRateVariabilitySDNN) | 自律神経バランス評価     |
| 安静時心拍数 | HKQuantityType(.restingHeartRate)         | 回復度・ストレス評価     |
| 睡眠分析     | HKCategoryType(.sleepAnalysis)            | 睡眠時間、睡眠ステージ   |
| 歩数         | HKQuantityType(.stepCount)                | 活動量評価               |
| 消費カロリー | HKQuantityType(.activeEnergyBurned)       | 運動量評価               |

#### 4.1.2 オプショナルデータ

| データ種別 | HKObjectType                      | 用途         |
| ---------- | --------------------------------- | ------------ |
| 酸素飽和度 | HKQuantityType(.oxygenSaturation) | 睡眠品質補助 |
| 体温       | HKQuantityType(.bodyTemperature)  | 回復度補助   |

### 4.2 気象・環境データ

#### 4.2.1 Open-Meteo Weather API

| データ項目 | 用途                         |
| ---------- | ---------------------------- |
| 気温       | 体調への影響、服装アドバイス |
| 湿度       | 体調への影響、水分補給       |
| 気圧       | 頭痛・体調不良の予測         |
| 天気コード | 外出アドバイス               |
| UV 指数    | 日焼け対策アドバイス         |
| 降水確率   | 外出アドバイス               |

#### 4.2.2 Open-Meteo Air Quality API

| データ項目        | 用途           |
| ----------------- | -------------- |
| AQI（大気質指数） | 外出アドバイス |
| PM2.5             | 呼吸器への影響 |
| PM10              | 呼吸器への影響 |

### 4.3 位置情報

| データ     | 取得方法                 | 精度                           |
| ---------- | ------------------------ | ------------------------------ |
| 都市名     | CoreLocation + Geocoding | 都市レベル                     |
| 緯度・経度 | CoreLocation             | 気象データ取得用（送信しない） |

---

## 5. ユーザープロフィール設計

### 5.1 データ構造

```swift
struct UserProfile: Codable {
    let nickname: String
    let age: Int
    let gender: Gender
    let weightKg: Double
    let heightCm: Double
    let occupation: Occupation?
    let lifestyleRhythm: LifestyleRhythm?
    let exerciseFrequency: ExerciseFrequency?
    let interestTags: [InterestTag]  // 1-3個
}
```

### 5.2 列挙型定義

#### Gender

```swift
enum Gender: String, Codable, CaseIterable {
    case male = "男性"
    case female = "女性"
    case other = "その他"
    case preferNotToSay = "回答しない"
}
```

#### Occupation

```swift
enum Occupation: String, Codable, CaseIterable {
    case deskWork = "デスクワーク（オフィス、IT、事務など）"
    case standingWork = "立ち仕事（接客、販売、医療など）"
    case physicalWork = "肉体労働（建設、配送、農業など）"
    case creative = "クリエイティブ（デザイン、アート、音楽など）"
    case education = "教育・研究（教師、研究者など）"
    case homemaker = "主婦・主夫"
    case student = "学生"
    case retired = "退職・シニア"
    case other = "その他"
}
```

#### LifestyleRhythm

```swift
enum LifestyleRhythm: String, Codable, CaseIterable {
    case earlyBird = "朝型（6時前に起床）"
    case regular = "普通（6-8時に起床）"
    case nightOwl = "夜型（8時以降に起床）"
    case irregular = "不規則"
}
```

#### ExerciseFrequency

```swift
enum ExerciseFrequency: String, Codable, CaseIterable {
    case almostDaily = "ほぼ毎日"
    case threeToFourTimes = "週3-4回"
    case oneToTwoTimes = "週1-2回"
    case occasionally = "たまに"
    case rarely = "ほとんどしない"
}
```

#### InterestTag

```swift
enum InterestTag: String, Codable, CaseIterable {
    case energy = "エネルギー・パフォーマンス"
    case nutrition = "栄養・食事"
    case fitness = "運動・フィットネス"
    case mental = "メンタル・ストレス"
    case beauty = "美容・スキンケア"
    case sleep = "睡眠"
}
```

---

## 6. オンボーディングフロー

### 6.1 画面構成

全 7 画面：

```
画面1: ウェルカム
    ↓
画面2: ニックネーム入力（必須）
    ↓
画面3: 基本情報入力（必須）
    ↓
画面4: 職業・生活習慣（任意）
    ↓
画面5: 関心ごとタグ選択（1-3個、必須）
    ↓
画面6: 権限リクエスト
    ↓
画面7: データ取得中
    ↓
ホーム画面（初回アドバイス表示）
```

### 6.2 各画面の詳細

#### 画面 1: ウェルカム

- 美しいビジュアル（Tempo AI のコンセプト表現）
- キャッチコピー: 「あなたのテンポで、健やかな毎日を」
- 3 つの特徴を簡潔に説明
- 「始める」ボタン

#### 画面 2: ニックネーム入力

- タイトル: 「あなたのお名前を教えてください」
- 説明: 「毎朝、あなたの名前でご挨拶します」
- テキスト入力フィールド
- 入力例: 「マサ」「あやか」など
- 「次へ」ボタン（入力必須）

#### 画面 3: 基本情報入力

- タイトル: 「基本情報を教えてください」
- 説明: 「より精度の高いアドバイスをお届けするために使用します」
- 入力項目:
  - 年齢（数値入力 or ピッカー）
  - 性別（選択式）
  - 体重（数値入力、kg）
  - 身長（数値入力、cm）
- 「次へ」ボタン

#### 画面 4: 職業・生活習慣入力

- タイトル: 「もう少し教えてください」
- 説明: 「あなたの生活スタイルに合わせたアドバイスができます（任意）」
- 入力項目:
  - 職業カテゴリー（選択式）
  - 生活リズム（選択式）
  - 運動習慣（選択式）
- 「スキップ」リンク + 「次へ」ボタン

#### 画面 5: 関心ごとタグ選択

- タイトル: 「あなたの関心ごとを教えてください」
- 説明: 「1〜3 個選んでください」
- 6 つのタグをカード形式で表示
- タップで選択状態に
- 「次へ」ボタン（最低 1 個選択必須）

#### 画面 6: 権限リクエスト

- タイトル: 「Tempo AI に必要な権限」
- 説明: 各権限の理由を簡潔に説明
  - ヘルスケアデータ: 「睡眠や心拍数などのデータを分析します」
  - 位置情報: 「天気や大気汚染の情報を取得します（都市レベルのみ）」
- 「許可して始める」ボタン

#### 画面 7: データ取得中

- ローディング画面
- メッセージ: 「あなた専用のアドバイスを準備中...」
- プログレスインジケーター
- 30 日分の HealthKit データ取得

#### 画面 8: ホーム画面

- 初回アドバイス表示

---

## 7. アドバイス生成ロジック

### 7.1 生成フロー

```
1. ユーザーがアプリを起動
    ↓
2. キャッシュ確認（同日のアドバイスがあるか）
    ↓ なければ
3. HealthKitからデータ取得（デバイス内）
    ↓
4. 位置情報から気象・大気汚染データ取得
    ↓
5. ユーザープロフィール + HealthKitデータ + 環境データを統合
    ↓
6. AI（Claude API）にデータ送信・アドバイス生成
    ↓
7. アドバイスをキャッシュ・表示
```

### 7.2 生成は 1 日 1 回のみ

| 時間帯       | 条件           | 生成内容             |
| ------------ | -------------- | -------------------- |
| 0:00〜23:59  | その日初回起動 | メインアドバイス生成 |
| 同日中再起動 | キャッシュあり | キャッシュ表示       |

### 7.3 キャッシュ戦略

| キー構造              | TTL     |
| --------------------- | ------- |
| `${deviceId}:${date}` | 24 時間 |

### 7.4 AI プロンプト構造

2 層構造でシンプルに設計：

```
┌─────────────────────────────────────────────────────┐
│ System Prompt（静的・Prompt Caching対象）            │
│ - 役割定義（ヘルスケアアドバイザー）                 │
│ - キャラクター設定（優しいお姉さん）                 │
│ - 制約事項                                          │
│ - 出力JSON形式                                      │
│ - 例文（関心ごと別に選択、1-3分野）                 │
│ - 推定: 約3,000-4,000トークン                       │
├─────────────────────────────────────────────────────┤
│ User Message（動的・キャッシュなし）                 │
│ - ユーザープロフィール                              │
│ - HealthKitデータ（当日・7日トレンド）              │
│ - 気象・環境データ                                  │
│ - 過去のDaily Try履歴（2週間）                      │
│ - 相関分析データ（ある場合）                        │
│ - 推定: 約800-1,200トークン                        │
└─────────────────────────────────────────────────────┘
```

### 7.5 AI 送信データ形式

AI プロンプトに送信するデータの詳細は、別途「[AI プロンプト仕様書](./ai-prompts/spec.md)」を参照してください。

---

## 8. エラーハンドリング

### 8.1 エラーケースと対応

| エラーケース           | 対応                                               |
| ---------------------- | -------------------------------------------------- |
| オフライン             | 「最新情報を取得できません」+ 前日のアドバイス表示 |
| HealthKit データ不足   | 一般的なアドバイス + データ不足の説明メッセージ    |
| 気象データ取得失敗     | 気象関連アドバイスを省略して生成                   |
| 大気汚染データ取得失敗 | 大気汚染関連アドバイスを省略して生成               |
| Claude API エラー      | フォールバック（一般的なアドバイス）表示           |
| 位置情報取得失敗       | 手動で都市を選択させるダイアログ表示               |

### 8.2 エラーメッセージ例

**オフライン時**

```
最新情報を取得できません。
インターネット接続を確認してください。
前日のアドバイスを表示しています。
```

**HealthKit データ不足時**

```
ヘルスケアデータが不足しています。
Apple Watchを装着して、数日間データを記録してください。
より精度の高いアドバイスをお届けできるようになります。
```

**位置情報取得失敗時**

```
位置情報を取得できませんでした。
天気情報を取得するため、お住まいの都市を選択してください。
```

### 8.3 エラーメッセージのトーン

- 通常トーン（優しいお姉さんトーンは適用しない）
- シンプルで分かりやすく
- ユーザーが次に取るべきアクションを明示

---

## 9. プライバシー・セキュリティ

### 9.1 データプライバシー方針

#### 9.1.1 基本原則

| 原則           | 内容                                   |
| -------------- | -------------------------------------- |
| データ最小化   | 必要最小限のデータのみ取得             |
| デバイス内処理 | HealthKit データはデバイス内のみに保存 |
| 匿名化         | AI 送信時は個人識別情報を除外          |
| 透明性         | データの使用目的を明確に説明           |

#### 9.1.2 AI 送信時のデータ処理

**送信するデータ**

- ニックネーム（呼びかけ用）
- 年齢、性別、体重、身長
- 職業カテゴリー、生活習慣
- 関心ごとタグ
- HealthKit 数値データ（集計・トレンド）
- 気象・大気汚染データ
- 都市名

**送信しないデータ**

- 本名、メールアドレス
- 詳細な位置情報（緯度・経度）
- デバイス固有 ID

### 9.2 必要なドキュメント（後日作成）

- プライバシーポリシー
- 利用規約
- HealthKit データ使用に関する説明（App Store 審査用）

---

## 10. MVP スコープ

### 10.1 Phase 1: 基本機能（MVP 初期リリース）

**含まれる機能:**

- ✅ オンボーディングフロー（ニックネーム、基本情報、職業、生活習慣、関心ごと）
- ✅ HealthKit 基本データ取得（心拍数、HRV、睡眠、歩数、運動）
- ✅ 気象データ統合（Open-Meteo）
- ✅ 大気汚染データ統合（Open-Meteo Air Quality）
- ✅ 関心ごとタグ設定（1-3 個）
- ✅ 毎朝のメインアドバイス生成（1 日 1 回）
- ✅ 今日のトライ提案
- ✅ ホーム画面（アドバイス + トライ）
- ✅ 設定画面（プロフィール編集、タグ変更）
- ✅ オフライン対応（前日アドバイス表示）

### 10.2 Phase 2: コンディション画面

- ✅ タブバーを 2 タブ → 3 タブに変更
- ✅ コンディショントップ画面
  - 24時間サークル図 + HRV統合表示
  - リズム安定度表示
  - 要因マップ（睡眠・環境・活動）
  - AIの見立て
- ✅ 詳細画面（1画面に統合）
  - あなたのパターン（散布図 + インサイト）※2週間後から表示
  - リズムを整えるヒント
- ✅ 要因の貢献度算出ロジック

### 10.3 将来バージョンに含める機能

**v1.1 以降**

- ⏳ 過去のアドバイス履歴表示
- ⏳ プッシュ通知（朝のリマインダーなど）
- ⏳ アドバイスの詳細な根拠表示（「なぜこのアドバイス?」）
- ⏳ ダークモード対応
- ⏳ 通知設定のカスタマイズ
- ⏳ トラベルモード（移動・時差対応）

**v2.0 以降**

- 🔮 ユーザーアカウント（Apple Sign In）
- 🔮 データ同期（複数デバイス対応）
- 🔮 アドバイス履歴の分析・トレンド表示
- 🔮 多言語対応（英語）

---

## 11. 関連ドキュメント

| ドキュメント名               | 内容                                          | ステータス |
| ---------------------------- | --------------------------------------------- | ---------- |
| AI プロンプト仕様書          | システムプロンプト、JSON スキーマ、データ形式 | 作成済み   |
| AI プロンプト例文集          | 分野別（6 種類）のアドバイス例文              | 作成済み   |
| UI/UX 仕様書                 | 詳細な画面設計、デザインシステム              | 作成済み   |
| 技術仕様書                   | アーキテクチャ、API 設計、データベース設計    | 作成済み   |
| メトリクスアルゴリズム仕様書 | 各スコアの算出ロジック詳細                    | 作成予定   |
| プライバシーポリシー         | データ取り扱いに関する法的文書                | 作成予定   |
| 利用規約                     | サービス利用に関する法的文書                  | 作成予定   |

### 11.1 AI プロンプト関連ドキュメント

```
ai-prompts/
├── spec.md                      # 仕様書（システムプロンプト + データスキーマ）
└── examples/
    ├── fitness.md               # 運動・フィットネス
    ├── beauty.md                # 美容・スキンケア
    ├── mental.md                # メンタル・ストレス
    ├── energy.md                # エネルギー・パフォーマンス
    ├── nutrition.md             # 栄養・食事
    └── sleep.md                 # 睡眠
```

---

## 付録

### A. 用語集

| 用語                          | 説明                                         |
| ----------------------------- | -------------------------------------------- |
| サーカディアンリズム          | 約 24 時間周期で変動する生理現象。体内時計。 |
| HRV（Heart Rate Variability） | 心拍変動。自律神経の状態や回復度を示す。     |
| リズム安定度スコア            | 就寝・起床時刻のばらつきから算出するスコア。 |
| AQI                           | Air Quality Index（大気質指数）              |

### B. v4.0 からの主な変更点

**v4.1 での変更:**

1. **action_suggestions 削除**: 「具体的な行動提案」セクションを削除し、condition.detail に統合
2. **condition.detail 拡張**: 5-8 文 → 8-12 文に拡張
3. **AI プロンプト構造簡略化**: 3 層構造 → 2 層構造に
4. **今日のトライ強化**: 「なぜ今日これなのか」の理由を必須に
5. **関連ドキュメント更新**: AI プロンプト仕様書のパス・構成を更新

**理由:**

- action_suggestions と Daily Try の重複解消
- より自然な文章でアドバイスを提供
- トークン効率の向上
- Daily Try のパーソナライズ強化

---

**以上、Tempo AI プロダクト仕様書 v4.1（シンプル化版）**
