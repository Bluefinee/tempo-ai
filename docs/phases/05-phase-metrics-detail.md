# Phase 5: コンディショントップ画面 UI 設計書

**フェーズ**: 5 / 17
**Part**: A（iOS UI）
**前提フェーズ**: Phase 2（タブバー）, Phase 4.5（ホーム画面メトリクス再設計）

---

## ⚠️ 実装前必読ドキュメント

**実装を開始する前に、以下のドキュメントを必ず確認してください：**

### 📋 必須参考資料

- **[CLAUDE.md](../../CLAUDE.md)** - 開発ガイドライン・基本原則
- **[メトリクスアルゴリズム仕様](../metrics-algorithm-spec.md)** - スコア算出ロジック
- **[相関分析仕様](../correlation-analysis-spec.md)** - 相関分析の活用
- **[アイコンデザインガイド](../icon-design-guide.md)** - アイコン仕様
- **[UI Specification](../ui-spec.md)** - UI 設計仕様書
- **[Technical Specification](../technical-spec.md)** - 技術仕様書
- **[Travel Mode & Condition Spec](../travel-mode-condition-spec.md)** - コンディション画面詳細仕様

### 📱 Swift/iOS 専用資料

- **[UX Concepts & Principles](../../.claude/ux_concepts.md)** - UX 設計原則
- **[Swift Coding Standards](../../.claude/swift-coding-standards.md)** - Swift 開発標準

### ✅ 実装完了後の必須作業

実装完了後は必ず以下を実行してください：

```bash
# リント・フォーマット確認
swiftlint
swift-format --lint --recursive ios/

# テスト実行
swift test
```

---

## このフェーズで実現すること

1. **コンディショントップ画面**（5 セクションのダッシュボード）
2. **各セクションカード**（サマリー表示）
3. **期間セレクター**（今日/今週/今月）
4. **詳細画面への遷移準備**（Phase 5.5 で実装）

---

## 完了条件

- [ ] タブバーの「コンディション」タブからコンディショントップ画面が表示される
- [ ] 5 つのセクションカード（リズム、HRV、睡眠、活動量、環境）が表示される
- [ ] 各カードにサマリー情報が表示される
- [ ] 期間セレクター（今日/今週/今月）が動作する
- [ ] 各カードタップで詳細画面への遷移（Phase 5.5 で View 実装後に接続）
- [ ] Mock データが正しく表示される

---

## コンセプト

> **「自分の体のリズムが今どうなっているか」を数値とビジュアルで把握する**

ホーム画面が「今日どう過ごすか」のアドバイス中心なのに対し、コンディション画面は「自分の状態を客観的に見る」ためのダッシュボード。

---

## 詳細レイアウト図

### コンディション画面（通常モード）

```
┌─────────────────────────────────────────┐
│ コンディション                 📅 今週 ▼│ ← ナビゲーションバー + 期間セレクター
├─────────────────────────────────────────┤ ← このフェーズで実装する範囲
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ [⏰↻] サーカディアンリズム      >   │ │ ← セクションカード1（カスタムアイコン）
│ │                                     │ │
│ │ 就寝 23:15 / 起床 7:05（平均）      │ │ ← メインデータ
│ │ リズム安定度: 82 - 安定 ✓           │ │ ← サブデータ・ステータス
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ [♡〜] HRV                       >   │ │ ← セクションカード2（カスタムアイコン）
│ │                                     │ │
│ │ 今朝 65ms / 7日平均 63ms (+2)       │ │ ← メインデータ
│ │ トレンド: 安定 →                    │ │ ← サブデータ・トレンド
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ [🌙Z] 睡眠                      >   │ │ ← セクションカード3（カスタムアイコン）
│ │                                     │ │
│ │ 昨夜 7h 00m / 深い睡眠 21%          │ │ ← メインデータ
│ │ 7日平均: 6h 45m                     │ │ ← サブデータ・平均値
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ [🚶] 活動量                     >   │ │ ← セクションカード4（カスタムアイコン）
│ │                                     │ │
│ │ 今日 2,500歩 / 7日平均 8,200歩      │ │ ← メインデータ
│ │ 今週の運動: 2回                     │ │ ← サブデータ・運動回数
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ [🌡️] 環境                       >   │ │ ← セクションカード5（カスタムアイコン）
│ │                                     │ │
│ │ 東京 12°C / 湿度 45% / AQI 42       │ │ ← メインデータ
│ │ 気圧 1018hPa（安定）                │ │ ← サブデータ・気圧トレンド
│ └─────────────────────────────────────┘ │
│                                         │
├─────────────────────────────────────────┤
│  [ホーム]  [コンディション]  [設定]     │ ← タブバー（3タブ）
└─────────────────────────────────────────┘
```

### トラベルモード時の画面（参考）

```
┌─────────────────────────────────────────┐
│ コンディション                 📅 今週 ▼│
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 🌡️ 環境差分                      >   │ │ ← 最上部に追加されるセクション
│ │                                     │ │
│ │ 📍 バンコク 🇹🇭（現在）             │ │
│ │ 🏠 拠点（東京）との差分              │ │
│ │ 気温 +18°C / 湿度 +33% / 時差 -2h   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ ⏰ サーカディアンリズム         >   │ │
│ │                                     │ │
│ │ ⚠️ 調整中 - ずれ 約2時間15分        │ │ ← トラベルモード時の表示
│ │ 就寝 1:15 / 起床 7:45（昨夜）      │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ [icon] HRV                       >   │ │
│ │                                     │ │
│ │ 今朝 58ms / 移動前平均 65ms (-7)    │ │ ← トラベルモード時の表示
│ │ [!] 移動による一時的な低下          │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ （以下、睡眠・活動量・環境）             │
│                                         │
├─────────────────────────────────────────┤
│  [ホーム]  [コンディション]  [設定]     │
└─────────────────────────────────────────┘
```

## 要素配置詳細

### 期間セレクター配置
- **位置**: ナビゲーションバー右上
- **表示**: 「📅 今週 ▼」形式
- **インタラクション**: タップでActionSheet表示（今日・今週・今月）

### セクションカードの配置原則
- **配置**: 縦スタック（5つのカードを縦に並べる）
- **順序**: リズム → HRV → 睡眠 → 活動量 → 環境
- **カード間隔**: 中程度のマージン
- **統一性**: 全カード同一幅、高さは内容に応じて調整

### 各カードの内部構造
```
┌─────────────────────────────────────────┐
│ [アイコン] [タイトル]              >    │ ← ヘッダー行
│                                         │
│ [メインデータ]                          │ ← 主要な数値・テキスト
│ [サブデータ / ステータス]               │ ← 補足情報
└─────────────────────────────────────────┘
```

### トラベルモード時の変化
- **環境差分セクション**: 最上部に挿入
- **既存セクション**: リズムとHRVの表示内容変更
- **視覚的区別**: ⚠️アイコンで「調整中」状態を明示

---

## セクションカード構成

### 共通構造

```
┌─────────────────────────────────────────┐
│ [アイコン] [タイトル]              >    │ ← ヘッダー行
│                                         │
│ [メインデータ]                          │ ← 主要な数値
│ [サブデータ / ステータス]               │ ← 補足情報
└─────────────────────────────────────────┘
```

### 各セクションの表示内容

| セクション           | アイコン                    | メインデータ             | サブデータ                      |
| -------------------- | --------------------------- | ------------------------ | ------------------------------- |
| サーカディアンリズム | 時計 + サイクル             | 就寝/起床時刻（平均）    | リズム安定度スコア + ステータス |
| HRV                  | ハート + 波形               | 今朝の値 / 7 日平均      | トレンド（上昇/安定/下降）      |
| 睡眠                 | 三日月 + Z                  | 昨夜の時間 / 深い睡眠%   | 7 日平均                        |
| 活動量               | 歩く人                      | 今日の歩数 / 7 日平均    | 今週の運動回数                  |
| 環境                 | 温度計                      | 都市 / 気温 / 湿度 / AQI | 気圧 + トレンド                 |

**注**: アイコンは SF Symbols または カスタムアイコンを使用。詳細は [アイコンデザインガイド](../icon-design-guide.md) を参照。

---

## 期間セレクター

```
┌──────────────────┐
│     📅 今週 ▼    │
└──────────────────┘
        ↓ タップ
┌──────────────────┐
│      今日        │
│    ✓ 今週        │
│      今月        │
└──────────────────┘
```

- デフォルト: 「今週」
- 選択肢: 「今日」「今週」「今月」
- 実装: ActionSheet または Menu

---

## 実装コンポーネント

### Views（Features/Condition/Views/）

```
Features/
└── Condition/
    └── Views/
        ├── ConditionView.swift              ← メイン画面
        └── Components/
            ├── ConditionSectionCard.swift   ← 共通カード
            ├── RhythmSectionCard.swift      ← リズム専用
            ├── HRVSectionCard.swift         ← HRV専用
            ├── SleepSectionCard.swift       ← 睡眠専用
            ├── ActivitySectionCard.swift    ← 活動量専用
            └── EnvironmentSectionCard.swift ← 環境専用
```

### Models（Features/Condition/Models/）

```
Features/
└── Condition/
    └── Models/
        ├── ConditionSummary.swift      ← 全体サマリー
        ├── RhythmSummary.swift         ← リズムサマリー
        ├── HRVSummary.swift            ← HRVサマリー
        ├── SleepSummary.swift          ← 睡眠サマリー
        ├── ActivitySummary.swift       ← 活動量サマリー
        └── EnvironmentSummary.swift    ← 環境サマリー
```

### ViewModels

```
Features/
└── Condition/
    └── ViewModels/
        └── ConditionViewModel.swift    ← メインViewModel
```

---

## Mock データ（サマリー用）

```swift
// ConditionMockData.swift

struct ConditionMockData {

    static let rhythmSummary = RhythmSummary(
        avgBedtime: "23:15",
        avgWakeTime: "7:05",
        stabilityScore: 82,
        stabilityStatus: .stable  // .veryStable, .stable, .unstable, .veryUnstable
    )

    static let hrvSummary = HRVSummary(
        currentValue: 65,
        avg7d: 63,
        diff: 2,
        trend: .stable  // .up, .stable, .down
    )

    static let sleepSummary = SleepSummary(
        lastNightDuration: 7.0,  // hours
        deepSleepPercent: 21,
        avg7dDuration: 6.75
    )

    static let activitySummary = ActivitySummary(
        todaySteps: 2500,
        avg7dSteps: 8200,
        weeklyWorkoutCount: 2
    )

    static let environmentSummary = EnvironmentSummary(
        city: "東京",
        temp: 12,
        humidity: 45,
        aqi: 42,
        pressure: 1018,
        pressureTrend: .stable  // .rising, .stable, .falling
    )
}
```

---

## リズム安定度ステータス

| スコア  | ステータス | 表示           |
| ------- | ---------- | -------------- |
| 80-100  | excellent  | 最高           |
| 60-79   | good       | 良好           |
| 40-59   | fair       | 普通           |
| 20-39   | low        | やや低下       |
| 0-19    | poor       | 要改善         |

**注**: スコア算出の詳細は [メトリクスアルゴリズム仕様](../metrics-algorithm-spec.md) を参照。

---

## カラー適用

| 要素                 | カラー          |
| -------------------- | --------------- |
| セクションカード背景 | Card Background |
| アイコン             | Primary Color   |
| メインデータ         | Primary Text    |
| サブデータ           | Secondary Text  |
| 安定度（高: 90+）    | Success Green   |
| 安定度（中: 75-89）  | Primary Color   |
| 安定度（低: 60-74）  | Warning Yellow  |
| 安定度（低: 0-59）   | Error Orange    |

---

## 画面遷移

```
コンディショントップ
    ├── リズムカードタップ → サーカディアンリズム詳細（Phase 5.5）
    ├── HRVカードタップ → HRV詳細（Phase 5.5）
    ├── 睡眠カードタップ → 睡眠詳細（Phase 5.5）
    ├── 活動量カードタップ → 活動量詳細（Phase 5.5）
    └── 環境カードタップ → 環境詳細（Phase 5.5）
```

**Phase 5 時点**: NavigationLink の設定まで。遷移先 View は Phase 5.5 で実装。

---

## Phase 5.5 との関係

| Phase 5（本フェーズ）        | Phase 5.5              |
| ---------------------------- | ---------------------- |
| コンディショントップ画面     | 5 つの詳細画面         |
| セクションカード（サマリー） | 詳細ビュー             |
| 期間セレクター               | 週間トレンドグラフ     |
| 遷移の準備                   | 遷移先の実装           |
| サマリー用 Model             | 詳細用 Model           |
| -                            | リズム安定度スコア算出 |
| -                            | ヒント条件分岐ロジック |

---

## 関連ドキュメント

- `travel-mode-condition-spec.md` - セクション 4「コンディション画面設計」
- `ui-spec.md` - セクション 7「詳細画面群」

---

## 改訂履歴

| バージョン | 日付       | 変更内容                                                     |
| ---------- | ---------- | ------------------------------------------------------------ |
| 1.0        | 2025-12-11 | 初版作成（Phase 5 を分割、トップ画面のみ）                   |
| 1.1        | 2025-12-13 | 新メトリクス体系に対応（絵文字→カスタムアイコン、参照ドキュメント追加） |
