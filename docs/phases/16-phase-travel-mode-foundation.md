# Phase 16: ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰åŸºç›¤è¨­è¨ˆæ›¸

**ãƒ•ã‚§ãƒ¼ã‚º**: 16 / 19  
**Part**: Eï¼ˆãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ï¼‰  
**å‰æãƒ•ã‚§ãƒ¼ã‚º**: Phase 15ï¼ˆãƒãƒªãƒƒã‚·ãƒ¥ï¼‰- é€šå¸¸ãƒ¢ãƒ¼ãƒ‰å®Œæˆå¾Œ

---

## âš ï¸ å®Ÿè£…å‰å¿…èª­ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**å®Ÿè£…ã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å¿…ãšç¢ºèªã—ã¦ãã ã•ã„ï¼š**

### ğŸ“‹ å¿…é ˆå‚è€ƒè³‡æ–™
- **[CLAUDE.md](../../CLAUDE.md)** - é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»åŸºæœ¬åŸå‰‡
- **[AI Prompt Design](../ai-prompt-design.md)** - AIè¨­è¨ˆæŒ‡é‡
- **[UI Specification](../ui-spec.md)** - UIè¨­è¨ˆä»•æ§˜æ›¸
- **[Technical Specification](../technical-spec.md)** - æŠ€è¡“ä»•æ§˜æ›¸
- **[Travel Mode & Condition Spec](../travel-mode-condition-spec.md)** - ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰è©³ç´°ä»•æ§˜

### ğŸ“± Swift/iOSå°‚ç”¨è³‡æ–™
- **[UX Concepts & Principles](../../.claude/ux_concepts.md)** - UXè¨­è¨ˆåŸå‰‡
- **[Swift Coding Standards](../../.claude/swift-coding-standards.md)** - Swifté–‹ç™ºæ¨™æº–

### âœ… å®Ÿè£…å®Œäº†å¾Œã®å¿…é ˆä½œæ¥­
å®Ÿè£…å®Œäº†å¾Œã¯å¿…ãšä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
```bash
# ãƒªãƒ³ãƒˆãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç¢ºèª
swiftlint
swift-format --lint --recursive ios/

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
swift test
```

---

## ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿç¾ã™ã‚‹ã“ã¨

1. **ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ã®ON/OFFæ©Ÿèƒ½**
2. **ãƒ›ãƒ¼ãƒ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ‹ ç‚¹ï¼‰è¨­å®š**
3. **ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¸ã®æ‹ ç‚¹è¨­å®šè¿½åŠ **
4. **è¨­å®šç”»é¢ã¸ã®ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ **

---

## å®Œäº†æ¡ä»¶

- [ ] è¨­å®šç”»é¢ã§ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚’ON/OFFã§ãã‚‹
- [ ] ãƒ›ãƒ¼ãƒ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šãƒ»ç·¨é›†ã§ãã‚‹
- [ ] ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§æ‹ ç‚¹ã‚’è¨­å®šã§ãã‚‹ï¼ˆã‚¹ã‚­ãƒƒãƒ—å¯èƒ½ï¼‰
- [ ] ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ã®çŠ¶æ…‹ãŒUserDefaultsã«æ°¸ç¶šåŒ–ã•ã‚Œã‚‹
- [ ] ãƒ›ãƒ¼ãƒ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒUserDefaultsã«æ°¸ç¶šåŒ–ã•ã‚Œã‚‹

---

## ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ã¨ã¯

> æ—…è¡Œã‚„å‡ºå¼µã§æ™®æ®µã¨ç•°ãªã‚‹å ´æ‰€ã«ã„ã‚‹ã¨ãã€ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ ã®èª¿æ•´ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ¢ãƒ¼ãƒ‰

### é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã¨ã®é•ã„

| é …ç›® | é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ | ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ |
|------|-----------|---------------|
| ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã®ç„¦ç‚¹ | å…¨èˆ¬çš„ãªå¥åº· | ãƒªã‚ºãƒ èª¿æ•´ä¸­å¿ƒ |
| ç’°å¢ƒè¡¨ç¤º | ç¾åœ¨åœ°ã®ã¿ | æ‹ ç‚¹ã¨ã®å·®åˆ†ã‚‚è¡¨ç¤º |
| ç‰¹åˆ¥ãªUI | ãªã— | ãƒªã‚»ãƒƒãƒˆãƒã‚¤ãƒ³ãƒˆã€é©å¿œã®ç›®å®‰ |

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### TravelModeState

```swift
struct TravelModeState: Codable {
    var isEnabled: Bool
    var enabledAt: Date?      // ONã«ã—ãŸæ—¥æ™‚
    var homeLocation: HomeLocation?
}

struct HomeLocation: Codable {
    let city: String          // éƒ½å¸‚åï¼ˆä¾‹: "æ±äº¬"ï¼‰
    let latitude: Double
    let longitude: Double
    let timezone: String      // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ï¼ˆä¾‹: "Asia/Tokyo"ï¼‰
    let registeredAt: Date    // ç™»éŒ²æ—¥æ™‚
}
```

### UserDefaultsã‚­ãƒ¼

```swift
enum TravelModeKeys {
    static let state = "travel_mode_state"
    static let homeLocation = "home_location"
}
```

---

## è¨­å®šç”»é¢ã®å¤‰æ›´

### è¨­å®šãƒˆãƒƒãƒ—ç”»é¢ã¸ã®è¿½åŠ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¨­å®š                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«                 >   â”‚ â”‚
â”‚ â”‚ ğŸ·ï¸ é–¢å¿ƒã”ã¨ã‚¿ã‚°                 >   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ ãƒ¢ãƒ¼ãƒ‰                           â† NEW! â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœˆï¸ ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰            [OFF]  â”‚ â”‚ â† ãƒˆã‚°ãƒ«
â”‚ â”‚ ğŸ  ãƒ›ãƒ¼ãƒ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³           >   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ ãã®ä»–                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼          >   â”‚ â”‚
â”‚ â”‚ â„¹ï¸ ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦               >   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ãƒˆã‚°ãƒ«

```swift
struct TravelModeToggleRow: View {
    @Binding var isEnabled: Bool
    
    var body: some View {
        HStack {
            Image(systemName: "airplane")
                .foregroundColor(.primary)
            
            Text("ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰")
            
            Spacer()
            
            Toggle("", isOn: $isEnabled)
                .labelsHidden()
        }
    }
}
```

### ãƒˆã‚°ãƒ«æ“ä½œæ™‚ã®å‹•ä½œ

```swift
func toggleTravelMode(_ enabled: Bool) {
    var state = loadTravelModeState()
    state.isEnabled = enabled
    
    if enabled {
        state.enabledAt = Date()
        
        // ãƒ›ãƒ¼ãƒ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœªè¨­å®šã®å ´åˆã¯è¨­å®šã‚’ä¿ƒã™
        if state.homeLocation == nil {
            showHomeLocationSetupPrompt = true
        }
    } else {
        state.enabledAt = nil
    }
    
    saveTravelModeState(state)
}
```

---

## ãƒ›ãƒ¼ãƒ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šç”»é¢

### ç”»é¢æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ãƒ›ãƒ¼ãƒ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ ğŸ  æ‹ ç‚¹ï¼ˆè‡ªå®…ï¼‰ã®å ´æ‰€ã‚’è¨­å®š              â”‚
â”‚                                         â”‚
â”‚ ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ä¸­ã€ã“ã“ã§è¨­å®šã—ãŸå ´æ‰€ã¨    â”‚
â”‚ ç¾åœ¨åœ°ã®ç’°å¢ƒå·®åˆ†ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚            â”‚
â”‚                                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                         â”‚
â”‚ ç¾åœ¨ã®è¨­å®š                              â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ æ±äº¬                             â”‚ â”‚
â”‚ â”‚    Asia/Tokyo                       â”‚ â”‚
â”‚ â”‚    ç™»éŒ²: 2025å¹´1æœˆ15æ—¥              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                         â”‚
â”‚ [ç¾åœ¨åœ°ã‚’æ‹ ç‚¹ã«è¨­å®š]                    â”‚
â”‚                                         â”‚
â”‚ [éƒ½å¸‚ã‚’æ¤œç´¢ã—ã¦è¨­å®š]                    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœªè¨­å®šæ™‚ã®è¡¨ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ãƒ›ãƒ¼ãƒ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ ğŸ  æ‹ ç‚¹ï¼ˆè‡ªå®…ï¼‰ã®å ´æ‰€ã‚’è¨­å®š              â”‚
â”‚                                         â”‚
â”‚ ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ä¸­ã€ã“ã“ã§è¨­å®šã—ãŸå ´æ‰€ã¨    â”‚
â”‚ ç¾åœ¨åœ°ã®ç’°å¢ƒå·®åˆ†ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚            â”‚
â”‚                                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                         â”‚
â”‚ âš ï¸ æ‹ ç‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“              â”‚
â”‚                                         â”‚
â”‚ ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†ã«ã¯ã€               â”‚
â”‚ ã¾ãšæ‹ ç‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚             â”‚
â”‚                                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                         â”‚
â”‚ [ç¾åœ¨åœ°ã‚’æ‹ ç‚¹ã«è¨­å®š]          â† Primary â”‚
â”‚                                         â”‚
â”‚ [éƒ½å¸‚ã‚’æ¤œç´¢ã—ã¦è¨­å®š]                    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ‹ ç‚¹è¨­å®šæ–¹æ³•

### æ–¹æ³•1: ç¾åœ¨åœ°ã‚’ä½¿ç”¨

```swift
func setCurrentLocationAsHome() async throws {
    // ä½ç½®æƒ…å ±å–å¾—
    let location = try await locationManager.getCurrentLocation()
    
    // é€†ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§éƒ½å¸‚åå–å¾—
    let placemark = try await geocoder.reverseGeocode(location)
    
    let homeLocation = HomeLocation(
        city: placemark.locality ?? "ä¸æ˜",
        latitude: location.coordinate.latitude,
        longitude: location.coordinate.longitude,
        timezone: TimeZone.current.identifier,
        registeredAt: Date()
    )
    
    saveHomeLocation(homeLocation)
}
```

### æ–¹æ³•2: éƒ½å¸‚æ¤œç´¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† éƒ½å¸‚ã‚’æ¤œç´¢                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ” éƒ½å¸‚åã‚’å…¥åŠ›...                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ æ¤œç´¢çµæœ                                â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ æ±äº¬, æ—¥æœ¬                       â”‚ â”‚
â”‚ â”‚    Asia/Tokyo                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ æ±äº¬éƒ½æ–°å®¿åŒº, æ—¥æœ¬               â”‚ â”‚
â”‚ â”‚    Asia/Tokyo                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```swift
func searchCities(query: String) async throws -> [CitySearchResult] {
    let geocoder = CLGeocoder()
    let placemarks = try await geocoder.geocodeAddressString(query)
    
    return placemarks.compactMap { placemark in
        guard let location = placemark.location,
              let city = placemark.locality else {
            return nil
        }
        
        return CitySearchResult(
            city: city,
            region: placemark.administrativeArea,
            country: placemark.country,
            latitude: location.coordinate.latitude,
            longitude: location.coordinate.longitude,
            timezone: placemark.timeZone?.identifier ?? TimeZone.current.identifier
        )
    }
}
```

---

## ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¸ã®è¿½åŠ 

### è¿½åŠ ç”»é¢ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰

ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®æœ€å¾Œã«æ‹ ç‚¹è¨­å®šç”»é¢ã‚’è¿½åŠ ï¼ˆã‚¹ã‚­ãƒƒãƒ—å¯èƒ½ï¼‰:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚             ğŸ                           â”‚
â”‚                                         â”‚
â”‚    æ‹ ç‚¹ã‚’è¨­å®šã—ã¾ã™ã‹ï¼Ÿ                  â”‚
â”‚                                         â”‚
â”‚  å‡ºå¼µã‚„æ—…è¡ŒãŒå¤šã„æ–¹ã¯ã€è‡ªå®…ã®å ´æ‰€ã‚’      â”‚
â”‚  è¨­å®šã—ã¦ãŠãã¨ã€ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§        â”‚
â”‚  ç’°å¢ƒã®é•ã„ã‚’ç¢ºèªã§ãã¾ã™ã€‚              â”‚
â”‚                                         â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     [ç¾åœ¨åœ°ã‚’æ‹ ç‚¹ã«è¨­å®š]        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     [éƒ½å¸‚ã‚’æ¤œç´¢ã—ã¦è¨­å®š]        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚         [ã‚ã¨ã§è¨­å®šã™ã‚‹]                â”‚
â”‚                                         â”‚
â”‚            â— â— â— â— â— â— â— â—‹             â”‚ â† 8/8
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼ã®å¤‰æ›´

```swift
enum OnboardingStep: Int, CaseIterable {
    case welcome = 0
    case healthPermission = 1
    case locationPermission = 2
    case profile = 3
    case interests = 4
    case lifestyle = 5
    case dataExplanation = 6
    case homeLocation = 7      // â† NEWï¼ˆã‚¹ã‚­ãƒƒãƒ—å¯èƒ½ï¼‰
}
```

---

## TravelModeManager

### ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

```swift
protocol TravelModeManagerProtocol {
    // çŠ¶æ…‹
    var isEnabled: Bool { get }
    var homeLocation: HomeLocation? { get }
    
    // æ“ä½œ
    func enable()
    func disable()
    func setHomeLocation(_ location: HomeLocation)
    func clearHomeLocation()
    
    // çŠ¶æ…‹å¤‰æ›´ã®é€šçŸ¥
    var statePublisher: AnyPublisher<TravelModeState, Never> { get }
}
```

### å®Ÿè£…

```swift
final class TravelModeManager: TravelModeManagerProtocol, ObservableObject {
    @Published private(set) var state: TravelModeState
    
    private let userDefaults: UserDefaults
    
    var isEnabled: Bool { state.isEnabled }
    var homeLocation: HomeLocation? { state.homeLocation }
    
    var statePublisher: AnyPublisher<TravelModeState, Never> {
        $state.eraseToAnyPublisher()
    }
    
    init(userDefaults: UserDefaults = .standard) {
        self.userDefaults = userDefaults
        self.state = Self.loadState(from: userDefaults)
    }
    
    func enable() {
        state.isEnabled = true
        state.enabledAt = Date()
        saveState()
    }
    
    func disable() {
        state.isEnabled = false
        state.enabledAt = nil
        saveState()
    }
    
    func setHomeLocation(_ location: HomeLocation) {
        state.homeLocation = location
        saveState()
    }
    
    func clearHomeLocation() {
        state.homeLocation = nil
        saveState()
    }
    
    private func saveState() {
        if let data = try? JSONEncoder().encode(state) {
            userDefaults.set(data, forKey: TravelModeKeys.state)
        }
    }
    
    private static func loadState(from userDefaults: UserDefaults) -> TravelModeState {
        guard let data = userDefaults.data(forKey: TravelModeKeys.state),
              let state = try? JSONDecoder().decode(TravelModeState.self, from: data) else {
            return TravelModeState(isEnabled: false, enabledAt: nil, homeLocation: nil)
        }
        return state
    }
}
```

---

## å®Ÿè£…ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### Views

```
Features/
â””â”€â”€ Settings/
    â””â”€â”€ Views/
        â”œâ”€â”€ SettingsView.swift              # æ—¢å­˜ã‚’æ‹¡å¼µ
        â”œâ”€â”€ TravelModeSection.swift         # NEW
        â””â”€â”€ HomeLocationView.swift          # NEW
            â”œâ”€â”€ HomeLocationSettingView.swift
            â””â”€â”€ CitySearchView.swift

Features/
â””â”€â”€ Onboarding/
    â””â”€â”€ Views/
        â””â”€â”€ HomeLocationOnboardingView.swift # NEW
```

### Managers

```
Core/
â””â”€â”€ Managers/
    â””â”€â”€ TravelModeManager.swift             # NEW
```

### Models

```
Core/
â””â”€â”€ Models/
    â””â”€â”€ TravelMode.swift                    # NEW
        â”œâ”€â”€ TravelModeState
        â””â”€â”€ HomeLocation
```

---

## ä¾å­˜é–¢ä¿‚

```
TravelModeManager
    â”‚
    â”œâ”€â”€ UserDefaultsï¼ˆæ°¸ç¶šåŒ–ï¼‰
    â”‚
    â””â”€â”€ LocationManagerï¼ˆç¾åœ¨åœ°å–å¾—ï¼‰
         â”‚
         â””â”€â”€ CLGeocoderï¼ˆé€†ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼‰
```

---

## ãƒ†ã‚¹ãƒˆè¦³ç‚¹

### æ­£å¸¸ç³»

- ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚’ONã«ã§ãã‚‹
- ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚’OFFã«ã§ãã‚‹
- ç¾åœ¨åœ°ã‚’æ‹ ç‚¹ã«è¨­å®šã§ãã‚‹
- éƒ½å¸‚æ¤œç´¢ã§æ‹ ç‚¹ã‚’è¨­å®šã§ãã‚‹
- çŠ¶æ…‹ãŒã‚¢ãƒ—ãƒªå†èµ·å‹•å¾Œã‚‚ä¿æŒã•ã‚Œã‚‹

### ç•°å¸¸ç³»

- ä½ç½®æƒ…å ±ãŒå–å¾—ã§ããªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- éƒ½å¸‚æ¤œç´¢ã§çµæœãŒãªã„å ´åˆã®è¡¨ç¤º
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹

- æ‹ ç‚¹æœªè¨­å®šã§ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚’ONã«ã—ãŸå ´åˆ
- ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§æ‹ ç‚¹è¨­å®šã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ãŸå ´åˆ

---

## ä»Šå¾Œã®ãƒ•ã‚§ãƒ¼ã‚ºã¨ã®é–¢ä¿‚

### Phase 17ã§ä½¿ç”¨

- ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ç®¡ç†ã®åŸºç›¤ã¨ã—ã¦ä½¿ç”¨

### Phase 18ã§ä½¿ç”¨

- ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ONæ™‚ã®UIè¡¨ç¤ºã®åˆ¤å®šã«ä½¿ç”¨

### Phase 19ã§ä½¿ç”¨

- AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¸ã®ãƒˆãƒ©ãƒ™ãƒ«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ ã«ä½¿ç”¨

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `travel-mode-condition-spec.md` - ãƒˆãƒ©ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰è©³ç´°ä»•æ§˜
- `06-phase-settings.md` - è¨­å®šç”»é¢ï¼ˆåŸºæœ¬ï¼‰
- `01-phase-onboarding.md` - ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

---

## æ”¹è¨‚å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|-----------|------|---------|
| 1.0 | 2025-12-11 | åˆç‰ˆä½œæˆ |
