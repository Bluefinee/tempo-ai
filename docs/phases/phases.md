# Tempo AI 開発フェーズ管理書

**バージョン**: 5.0
**最終更新日**: 2025年12月19日

---

> **📖 事前確認**: 各フェーズの実装前に、[product-spec.md](../specs/product-spec.md) を参照してプロダクトの全体像を理解してください。

---

## 全体構成

| Part | フェーズ | 概要 | ステータス |
|------|---------|------|-----------|
| **A: iOS UI** | Phase 1〜4 | Mockデータを使用したUI実装 | ✅ 完了 |
| **B: Backend** | Phase 5〜8 | API・外部サービス統合 | ✅ 完了 |
| **C: 新仕様調整** | Phase 9〜11 | 実装済み機能を新仕様に適合 | 🔜 次 |
| **D: サーカディアンリズム** | Phase 12〜13 | サーカディアンリズム画面 | 📋 計画中 |
| **E: 結合** | Phase 14 | UIとAPIの接続 | 📋 計画中 |
| **F: 仕上げ** | Phase 15 | エラー処理、ポリッシュ（MVP完成） | 📋 計画中 |

---

## 開発フロー

```
Part A (iOS UI)              Part B (Backend)
Phase 1-4 ✅                 Phase 5-8 ✅
    │                            │
    └──────────┬─────────────────┘
               │
    ═══════════════════════════════════
    ↑ ここまで実装済み（旧仕様）  ↑
    ═══════════════════════════════════
               │
         Part C (調整)
    Phase 9: ホーム画面シンプル化 🔜
    Phase 10: Backend調整 🔜
    Phase 11: タブバー拡張 🔜
               │
         Part D (サーカディアンリズム)
    Phase 12: サーカディアンリズム画面
    Phase 13: 詳細画面 → v1.1に延期
               │
         Part E/F (結合・仕上げ)
    Phase 14: UI結合・キャッシュ
    Phase 15: エラー処理・ポリッシュ
               │
    ═══════════════════════════════════
    ↑      MVP 完成ライン         ↑
    ═══════════════════════════════════
```

---

## 必須確認事項

### 実装前

| フェーズ | 確認ドキュメント |
|---------|----------------|
| 全フェーズ | [product-spec.md](../specs/product-spec.md), [ui-spec.md](../specs/ui-spec.md) |
| iOS (1-4, 9, 11-15) | Swift Coding Standards, UX Concepts |
| Backend (5-8, 10) | TypeScript Hono Standards |
| メトリクス関連 | [metrics-spec.md](../specs/metrics-spec.md) |
| AI関連 | [ai-prompt-spec.md](../specs/ai-prompt-spec.md) |

### 実装後

**iOS側**: `swiftlint && swift test`  
**Backend側**: `npm run typecheck && npm run lint && npm test`

---

## Part A: iOS UI（実装済み）

### Phase 1: オンボーディング ✅

**完了条件**:
- [ ] オンボーディング全7画面が動作
- [ ] HealthKit権限リクエストが動作
- [ ] LocationManager権限リクエストが動作
- [ ] UserDefaultsへのプロフィール保存が動作

---

### Phase 2: ホーム画面基本 ✅

**完了条件**:
- [ ] ヘッダー（日付、挨拶）が表示
- [ ] アドバイスサマリーカードが表示
- [ ] タブバー（ホーム / 設定）が動作

---

### Phase 3: ホーム画面メトリクス・トライ ✅

> ⚠️ Phase 9で新仕様に調整（メトリクスカード削除、今週のトライ削除、追加アドバイス削除）

**完了条件**:
- [ ] メトリクスカード4つが表示
- [ ] 今日のトライカードが表示
- [ ] 今週のトライカードが表示（月曜のみ）

---

### Phase 4: 詳細画面 ✅

> ⚠️ 今週のトライ詳細画面はPhase 9で削除

**完了条件**:
- [ ] アドバイス詳細画面への遷移が動作
- [ ] トライ詳細画面への遷移が動作

---

## Part B: Backend（実装済み）

### Phase 5: Backend基盤 ✅

**完了条件**:
- [ ] Hono Routerセットアップ完了
- [ ] `/api/advice`エンドポイントが動作
- [ ] iOS APIClientとの疎通確認

---

### Phase 6: 外部API統合 ✅

**完了条件**:
- [ ] Open-Meteo Weather API統合
- [ ] Open-Meteo Air Quality API統合
- [ ] フォールバック処理が動作

---

### Phase 7: Claude API統合 ✅

> ⚠️ Phase 10で新仕様に調整（追加アドバイス削除、今週のトライ削除、insight追加）

**完了条件**:
- [ ] Claude Sonnetでメインアドバイス生成
- [ ] Prompt Caching設定完了
- [ ] JSONパースが動作

---

### Phase 8: 環境データAPI ✅

**完了条件**:
- [ ] 気圧トレンドなど追加環境データ取得
- [ ] 環境データの整形完了

---

## Part C: 新仕様への調整

### Phase 9: ホーム画面シンプル化 🔜

**目的**: Phase 3で実装した旧仕様を新仕様に調整

**削除対象**:
- メトリクスカード4つ
- 今週のトライカード + 詳細画面
- 追加アドバイス（フローティング吹き出し）

**完了条件**:
- [ ] ホーム画面が「ヘッダー + アドバイス + トライ」の3要素のみ
- [ ] 削除した機能のコードが完全に除去
- [ ] [ui-spec.md](../specs/ui-spec.md) セクション4に一致

---

### Phase 10: Backend調整 🔜

**目的**: Phase 7で実装した旧仕様を新仕様に調整

**削除対象**:
- 追加アドバイス生成ロジック（Claude Haiku使用）
- 今週のトライ生成ロジック

**追加対象**:
- `insight`フィールド（AIの見立て）
- リクエストデータ拡張（scores, rhythm_stability）

**完了条件**:
- [ ] Claude Sonnetのみ使用（Haiku不使用）
- [ ] `insight`フィールドが出力に含まれる
- [ ] [ai-prompt-spec.md](../specs/ai-prompt-spec.md) に準拠

---

### Phase 11: タブバー拡張 🔜

**目的**: タブバーを2つから3つに拡張

**変更内容**:
- タブバー: ホーム / 設定 → ホーム / サーカディアンリズム / 設定
- サーカディアンリズムタブのプレースホルダー画面を追加

**完了条件**:
- [ ] タブバーが3つになっている
- [ ] サーカディアンリズムタブでプレースホルダーが表示
- [ ] オンボーディング完了後のデフォルトタブがホーム

---

## Part D: サーカディアンリズム画面

### Phase 12: サーカディアンリズム画面

**目的**: 新設計のサーカディアンリズム画面を実装

**実装要素**:
1. 24時間サークル図 + HRV統合表示
2. 3つの指標セクション（HRV・睡眠・歩数の三角形）
3. リズム安定度表示
4. AIの見立て

**完了条件**:
- [ ] 24時間サークル図が正しく描画
- [ ] 3つの指標が三角形構造で表示
- [ ] リズム安定度が条件分岐で正しく表示
- [ ] `insight`が表示
- [ ] [ui-spec.md](../specs/ui-spec.md) セクション5に一致
- [ ] [metrics-spec.md](../specs/metrics-spec.md) に準拠

---

### Phase 13: 詳細画面 → v1.1に延期

**延期理由**:
- MVPの複雑さを減らす
- 散布図なしだと存在意義が薄い
- ユーザーフィードバック優先

**v1.1で実装予定**:
- 「あなたのパターン」セクション（散布図 + インサイト文）
- 「リズムを整えるヒント」セクション

---

## Part E: 結合

### Phase 14: UI結合・キャッシュ

**目的**: MockをAPI実データに置き換え、キャッシュ実装

**スコープ**:
1. 全画面のMockデータを実APIレスポンスに置き換え
2. CacheManager実装（同日キャッシュ24時間）
3. オフライン対応（前日アドバイス表示）

**完了条件**:
- [ ] 全画面が実APIデータで動作
- [ ] 同日2回目の起動でキャッシュ使用
- [ ] オフライン時に前日アドバイス表示
- [ ] Mockデータが完全に削除

---

## Part F: 仕上げ

### Phase 15: エラー処理・ポリッシュ

**目的**: エッジケース対応とUXの仕上げ

**スコープ**:
1. エラー画面（HealthKit不足、位置情報失敗、オフライン）
2. ローディング表示（0.4秒ルール）
3. アニメーション（画面遷移、マイクロインタラクション）
4. アクセシビリティ対応

**完了条件**:
- [ ] 全エラーケースに対応
- [ ] ローディングが0.4秒ルールに従う
- [ ] VoiceOverで全画面ナビゲート可能
- [ ] メモリリークがない

---

## ═══════════════════════════════════════
## 🎉 MVP 完成（Phase 15完了時点）
## ═══════════════════════════════════════

---

## 依存関係

```
Phase 1 ← 独立
Phase 2 ← Phase 1
Phase 3 ← Phase 2
Phase 4 ← Phase 2, 3

Phase 5 ← 独立
Phase 6 ← Phase 5
Phase 7 ← Phase 5, 6
Phase 8 ← Phase 5, 6

─── 実装済みライン ───

Phase 9  ← Phase 3
Phase 10 ← Phase 7
Phase 11 ← Phase 2, 9

Phase 12 ← Phase 10, 11
Phase 13 ← Phase 12 → v1.1に延期

Phase 14 ← Phase 1〜12
Phase 15 ← Phase 14

─── MVP完成 ───
```

---

## 関連ドキュメント

| ドキュメント | 内容 |
|-------------|------|
| [product-spec.md](../specs/product-spec.md) | 機能要件 |
| [ui-spec.md](../specs/ui-spec.md) | UI/UX設計 |
| [metrics-spec.md](../specs/metrics-spec.md) | スコア算出 |
| [ai-prompt-spec.md](../specs/ai-prompt-spec.md) | AIプロンプト |
