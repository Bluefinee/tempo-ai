# Phase 3: ホーム画面UI（メトリクス・トライ）設計書

**フェーズ**: 3 / 14  
**Part**: A（iOS UI）  
**前提フェーズ**: Phase 2（ホーム画面基本構造）

---

## このフェーズで実現すること

1. **メトリクスカード4つ**（回復・睡眠・エネルギー・ストレス）の表示
2. **今日のトライカード**の表示
3. **今週のトライカード**の表示（月曜日のみ目立つ表示）
4. **追加アドバイス**（フローティング吹き出し）のUI

---

## 完了条件

- [ ] メトリクスカード4つが2×2グリッドで表示される
- [ ] 各メトリクスカードに数値とプログレスバーが表示される
- [ ] 今日のトライカードにタイトルとサマリーが表示される
- [ ] 今週のトライカードが表示される（月曜とそれ以外で表示が異なる）
- [ ] 追加アドバイスの吹き出しが表示・非表示できる
- [ ] 全要素がMockデータで正しく表示される

---

## 画面構成（完成形）

```
┌─────────────────────────────────────┐
│ ヘッダー（Phase 2で実装済み）        │
├─────────────────────────────────────┤
│ アドバイスサマリーカード（実装済み）  │
├─────────────────────────────────────┤
│ メトリクスカード（2×2グリッド）      │
│ ┌─────────┐ ┌─────────┐           │
│ │ 回復    │ │ 睡眠    │           │
│ └─────────┘ └─────────┘           │
│ ┌─────────┐ ┌─────────┐           │
│ │エネルギー│ │ストレス │           │
│ └─────────┘ └─────────┘           │
├─────────────────────────────────────┤
│ 🎯 今日のトライ                     │
│ [タイトルとサマリー]                │
├─────────────────────────────────────┤
│ 📅 今週のトライ                     │
│ [タイトルとサマリー]                │
├─────────────────────────────────────┤
│ タブバー（実装済み）                │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 💬 追加アドバイス（フローティング）  │
│ [短いメッセージ]            [×]    │
└─────────────────────────────────────┘
```

---

## メトリクスカード

### 概要

4つの健康指標を視覚的に表示するカード群。

| カード | 指標 | データソース |
|--------|------|-------------|
| 回復 | HRVベースの回復度 | HRV値 |
| 睡眠 | 睡眠の質・量 | 睡眠データ |
| エネルギー | 活動量・消費カロリー | 歩数、運動データ |
| ストレス | 自律神経の状態 | HRV、心拍数 |

### カード構成要素

```
┌─────────────────┐
│ 🔋 回復         │ ← アイコン + ラベル
│                 │
│ 良好            │ ← 状態テキスト
│ ████████░░ 78%  │ ← プログレスバー + 数値
└─────────────────┘
```

**各要素**:
- アイコン: 絵文字を使用
- ラベル: 指標名
- 状態テキスト: 「良好」「普通」「注意」など
- プログレスバー: 0〜100%の視覚表現
- 数値: パーセント表示

### 状態テキストの基準（目安）

| スコア | 状態テキスト |
|--------|-------------|
| 80〜100% | 最高 |
| 60〜79% | 良好 |
| 40〜59% | 普通 |
| 20〜39% | やや低め |
| 0〜19% | 注意 |

### レイアウト

- 2×2のグリッド配置
- 各カードは同じサイズ
- カード間に適度な間隔

### タップ動作

- カードタップでメトリクス詳細画面へ遷移（Phase 5で実装）
- このフェーズではタップしても何も起きない、または視覚的フィードバックのみ

---

## 今日のトライカード

### 概要

1日1つの小さなチャレンジを提案するカード。

### カード構成要素

```
┌─────────────────────────────────────┐
│ 🎯 今日のトライ                     │
│                                     │
│ ドロップセット法に挑戦              │ ← タイトル
│                                     │
│ トレーニングの最後に、普段と違う    │
│ 刺激を筋肉に与えてみませんか？      │ ← サマリー
│                                     │
│                    [詳しく見る →]   │
└─────────────────────────────────────┘
```

**各要素**:
- セクションタイトル: 「🎯 今日のトライ」
- タイトル: `daily_try.title`
- サマリー: `daily_try.summary`
- 「詳しく見る」リンク

### スタイル

- 背景: Card Background
- Accent Color でアクセントをつけてもよい
- タイトルは太字

### タップ動作

- カード全体 or 「詳しく見る」で詳細画面へ（Phase 4で実装）

---

## 今週のトライカード

### 概要

毎週月曜日に設定される、1週間を通して取り組むチャレンジ。

### 表示ルール

| 曜日 | 表示方法 |
|------|---------|
| 月曜日 | 目立つ表示（大きめ、強調色） |
| 火〜日曜 | 小さめ表示（折りたたみ or コンパクト） |

### 月曜日の表示

```
┌─────────────────────────────────────┐
│ 📅 今週のトライ               NEW!  │
│                                     │
│ セサミオイルで足裏マッサージ        │
│                                     │
│ アーユルヴェーダの知恵で、          │
│ 深い眠りと自律神経の安定を          │
│                                     │
│                    [詳しく見る →]   │
└─────────────────────────────────────┘
```

### 火〜日曜の表示

```
┌─────────────────────────────────────┐
│ 📅 今週のトライ: セサミオイルで...  │
└─────────────────────────────────────┘
```

- 1行にコンパクトに表示
- タップで展開 or 詳細画面へ

### 曜日判定

- 現在の曜日を取得
- 月曜日（weekday == 2 in Calendar）の場合は目立つ表示

---

## 追加アドバイス（フローティング吹き出し）

### 概要

13時以降、18時以降にアプリを開いた際に表示される短いアドバイス。

### 表示条件

| 時間帯 | 条件 |
|--------|------|
| 昼 | 13:00以降、その時間帯で初回起動時 |
| 夕 | 18:00以降、その時間帯で初回起動時 |

### UI構成

```
┌─────────────────────────────────────┐
│ 💬                           [×]   │
│                                     │
│ 午前中の心拍数が普段より10%ほど     │
│ 高めで推移していました。            │
│ 深呼吸を3回、ゆっくり行って         │
│ みてください。                      │
└─────────────────────────────────────┘
```

**各要素**:
- 💬 アイコン（左上）
- ×ボタン（右上、閉じる）
- メッセージ本文

### 表示位置

- 画面下部、タブバーの上にフローティング
- または画面上部にオーバーレイ

### インタラクション

- ×ボタンで閉じる
- 上にスワイプで閉じる
- 閉じた後は同日中に再表示しない

### このフェーズでの実装範囲

- UIコンポーネントの実装
- 表示/非表示のトグル
- 閉じるボタンの動作

※ 実際の表示条件判定やAPI連携はPhase 12で実装

---

## Mockデータ

### メトリクスMock

```
回復:
  score: 78
  status: "良好"

睡眠:
  score: 85
  status: "最高"

エネルギー:
  score: 62
  status: "良好"

ストレス:
  score: 45
  status: "普通"
```

### 今日のトライMock

```
daily_try:
  title: "ドロップセット法に挑戦"
  summary: "トレーニングの最後に、普段と違う刺激を筋肉に与えてみませんか？"
```

### 今週のトライMock

```
weekly_try:
  title: "セサミオイルで足裏マッサージ"
  summary: "アーユルヴェーダの知恵で、深い眠りと自律神経の安定を"
```

### 追加アドバイスMock

```
additional_advice:
  message: "午前中の心拍数が普段より10%ほど高めで推移していました。
            深呼吸を3回、ゆっくり行ってみてください。"
```

---

## 実装コンポーネント

### Views（Features/Home/Views/）

- `MetricsGridView` - メトリクスカードのグリッドコンテナ
- `MetricCard` - 個別のメトリクスカード
- `DailyTryCard` - 今日のトライカード
- `WeeklyTryCard` - 今週のトライカード
- `AdditionalAdvicePopup` - 追加アドバイスの吹き出し

### Models（Features/Home/Models/）

- `MetricData` - メトリクスのデータ構造
- `TryContent` - トライのデータ構造（daily/weekly共通）
- `AdditionalAdvice` - 追加アドバイスのデータ構造

---

## スクロール動作の更新

Phase 2からの変更:

```
スクロール可能な領域:
├─ アドバイスサマリーカード
├─ メトリクスカード（2×2）
├─ 今日のトライカード
└─ 今週のトライカード

固定要素:
├─ ヘッダー（上部固定）
└─ タブバー（下部固定）

フローティング要素:
└─ 追加アドバイス（表示時のみ）
```

---

## カラー適用

| 要素 | カラー |
|------|--------|
| メトリクスカード背景 | Card Background |
| プログレスバー（塗り） | Primary Color |
| プログレスバー（背景） | 薄いグレー |
| 今日のトライのアクセント | Accent Color |
| 追加アドバイス背景 | Card Background |
| ×ボタン | Secondary Text |

---

## 今後のフェーズとの関係

### Phase 4で追加

- 今日のトライカードタップ → 詳細画面へ
- 今週のトライカードタップ → 詳細画面へ

### Phase 5で追加

- メトリクスカードタップ → 各詳細画面へ

### Phase 10で変更

- MockデータをAPIレスポンスに置き換え

### Phase 12で追加

- 追加アドバイスの表示条件判定
- 時間帯ベースの表示制御

---

## UI/UXポイント

### メトリクスカード

- 一目で状態が分かるように、プログレスバーの色分けを検討
- 高スコア: 緑系、低スコア: 黄色〜オレンジ系

### 今日のトライ

- 「今日やってみよう」という軽い提案感
- 圧迫感を与えないデザイン

### 追加アドバイス

- 突然現れても驚かない、柔らかいアニメーション
- 簡単に閉じられることを明示

---

## 関連ドキュメント

- `ui-spec.md` - セクション6「ホーム画面」
- `product-spec.md` - セクション2.2〜2.4「トライ機能」「追加アドバイス機能」
- `ai-prompt-design.md` - セクション2「JSON出力スキーマ」

---

## 改訂履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0 | 2025-12-10 | 初版作成 |
