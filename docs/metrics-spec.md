# ãƒ¡ãƒˆãƒªã‚¯ã‚¹ä»•æ§˜æ›¸

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.0
**æœ€çµ‚æ›´æ–°æ—¥**: 2025 å¹´ 12 æœˆ 19 æ—¥
**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: [product-spec.md](./product-spec.md), [ui-spec.md](./ui-spec.md)

---

## ç›®æ¬¡

1. [æ¦‚è¦](#1-æ¦‚è¦)
2. [ãƒ¡ãƒˆãƒªã‚¯ã‚¹ä½“ç³»](#2-ãƒ¡ãƒˆãƒªã‚¯ã‚¹ä½“ç³»)
3. [ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ è©³ç´°](#3-ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ è©³ç´°)
4. [ç¡çœ ã‚¹ã‚³ã‚¢](#4-ç¡çœ ã‚¹ã‚³ã‚¢)
5. [HRV ã‚¹ã‚³ã‚¢](#5-hrvã‚¹ã‚³ã‚¢)
6. [æ´»å‹•é‡ã‚¹ã‚³ã‚¢](#6-æ´»å‹•é‡ã‚¹ã‚³ã‚¢)
7. [ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®š](#7-ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®š)
8. [ãƒ‡ãƒ¼ã‚¿è¦ä»¶](#8-ãƒ‡ãƒ¼ã‚¿è¦ä»¶)
9. [è¦å› ã®è²¢çŒ®åº¦ç®—å‡º](#9-è¦å› ã®è²¢çŒ®åº¦ç®—å‡º)
10. [ã€Œã‚ãªãŸã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã®ç›¸é–¢åˆ†æ](#10-ã‚ãªãŸã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç›¸é–¢åˆ†æ)

---

## 1. æ¦‚è¦

Tempo AI ã®å¥åº·ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¯ã€**è‡ªå¾‹ç¥çµŒãƒãƒ©ãƒ³ã‚¹**ã¨**ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ **ã‚’æ ¸å¿ƒã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

### 1.1 æ ¸å¿ƒã‚³ãƒ³ã‚»ãƒ—ãƒˆ

| æ¦‚å¿µ                 | èª¬æ˜                               | å¯¾å¿œãƒ¡ãƒˆãƒªã‚¯ã‚¹ |
| -------------------- | ---------------------------------- | -------------- |
| è‡ªå¾‹ç¥çµŒãƒãƒ©ãƒ³ã‚¹     | äº¤æ„Ÿç¥çµŒã¨å‰¯äº¤æ„Ÿç¥çµŒã®ãƒãƒ©ãƒ³ã‚¹çŠ¶æ…‹ | HRV, ã‚¹ãƒˆãƒ¬ã‚¹  |
| ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ  | ä½“å†…æ™‚è¨ˆã®å®‰å®šæ€§ã¨è¦å‰‡æ€§           | ãƒªã‚ºãƒ , ç¡çœ    |
| èº«ä½“æ´»å‹•             | æ—¥ä¸­ã®æ´»å‹•é‡ã¨å›å¾©ã®é–¢ä¿‚           | æ´»å‹•é‡         |

---

## 2. ãƒ¡ãƒˆãƒªã‚¯ã‚¹ä½“ç³»

### 2.1 5 ã¤ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹               | æ¦‚å¿µ                           | ã‚¹ã‚³ã‚¢ç¯„å›² | ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹                 |
| ------------------------ | ------------------------------ | ---------- | ---------------------------- |
| **ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ ** | ä½“å†…æ™‚è¨ˆã®å®‰å®šæ€§               | 0-100      | ç¡çœ ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç®—å‡º           |
| ç¡çœ                      | ç¡çœ ã®è³ªã¨é‡                   | 0-100      | HealthKit (HKCategorySample) |
| HRV                      | å¿ƒæ‹å¤‰å‹•ã«ã‚ˆã‚‹è‡ªå¾‹ç¥çµŒçŠ¶æ…‹     | 0-100      | HealthKit (HKQuantityType)   |
| æ´»å‹•é‡                   | æ—¥ä¸­ã®èº«ä½“æ´»å‹•ãƒ¬ãƒ™ãƒ«           | 0-100      | HealthKit (HKQuantityType)   |
| ã‚¹ãƒˆãƒ¬ã‚¹                 | è‡ªå¾‹ç¥çµŒãƒãƒ©ãƒ³ã‚¹ï¼ˆHRV ãƒ™ãƒ¼ã‚¹ï¼‰ | 0-100      | HRV + å¿ƒæ‹æ•°ã‹ã‚‰ç®—å‡º         |

### 2.2 è¡¨ç¤ºæ§‹æˆ

**ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ç”»é¢**:

```
â”Œâ”€ 24æ™‚é–“ã‚µãƒ¼ã‚¯ãƒ«å›³ + HRV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤–å‘¨: éå»7æ—¥ã®ç¡çœ ãƒ—ãƒ­ãƒƒãƒˆ       â”‚
â”‚ ä¸­å¤®: HRVå€¤ + 7æ—¥å¹³å‡ã¨ã®å·®åˆ†    â”‚
â”‚ ä¸‹éƒ¨: å°±å¯æ™‚åˆ»ãƒ»èµ·åºŠæ™‚åˆ»         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ ãƒªã‚ºãƒ å®‰å®šåº¦ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ + ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼       â”‚
â”‚ èª¬æ˜æ–‡ï¼ˆå›å¾©åŠ¹ç‡ã¸ã®å½±éŸ¿ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ è¦å› ãƒãƒƒãƒ— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¡çœ : è²¢çŒ®åº¦ + è©³ç´°              â”‚
â”‚ ç’°å¢ƒ: è²¢çŒ®åº¦ + è©³ç´°              â”‚
â”‚ æ´»å‹•: è²¢çŒ®åº¦ + è©³ç´°              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ AIã®è¦‹ç«‹ã¦ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3-5æ–‡ã®çµ±åˆè§£é‡ˆ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ è©³ç´°

### 3.1 æ¦‚è¦

ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ ã¯ä½“å†…æ™‚è¨ˆã®å®‰å®šæ€§ã‚’ç¤ºã™æœ€é‡è¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§ã™ã€‚å°±å¯ãƒ»èµ·åºŠæ™‚åˆ»ã®è¦å‰‡æ€§ãŒã€ç¡çœ ã®è³ªã€HRVã€å…¨ä½“çš„ãªã‚¦ã‚§ãƒ«ãƒ“ãƒ¼ã‚¤ãƒ³ã‚°ã«å½±éŸ¿ã—ã¾ã™ã€‚

### 3.2 ã‚¹ã‚³ã‚¢ç®—å‡ºï¼ˆ0-100ï¼‰

```
ç·åˆã‚¹ã‚³ã‚¢ = å°±å¯æ™‚åˆ»å®‰å®šåº¦(35) + èµ·åºŠæ™‚åˆ»å®‰å®šåº¦(35) + é€±æœ«ã‚·ãƒ•ãƒˆ(20) + ç†æƒ³æ™‚é–“å¸¯(10)
```

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | é…ç‚¹  | ç®—å‡ºæ–¹æ³•                                         |
| -------------- | ----- | ------------------------------------------------ |
| å°±å¯æ™‚åˆ»å®‰å®šåº¦ | 35 ç‚¹ | éå» 7 æ—¥é–“ã®å°±å¯æ™‚åˆ»ã®æ¨™æº–åå·®ã€30 åˆ†ä»¥å†…ã§æº€ç‚¹ |
| èµ·åºŠæ™‚åˆ»å®‰å®šåº¦ | 35 ç‚¹ | éå» 7 æ—¥é–“ã®èµ·åºŠæ™‚åˆ»ã®æ¨™æº–åå·®ã€30 åˆ†ä»¥å†…ã§æº€ç‚¹ |
| é€±æœ«ã‚·ãƒ•ãƒˆ     | 20 ç‚¹ | å¹³æ—¥ã¨é€±æœ«ã®ç¡çœ æ™‚é–“å¸¯ã®å·®ã€1 æ™‚é–“ä»¥å†…ã§æº€ç‚¹     |
| ç†æƒ³æ™‚é–“å¸¯     | 10 ç‚¹ | 22:00-6:00 ã®ç¯„å›²å†…ã§å°±å¯ãƒ»èµ·åºŠã—ã¦ã„ã‚‹ã‹        |

#### ç®—å‡ºã‚³ãƒ¼ãƒ‰

```swift
func calculateRhythmScore(
    bedtimes: [Date],           // éå»7æ—¥é–“ã®å°±å¯æ™‚åˆ»
    wakeups: [Date],            // éå»7æ—¥é–“ã®èµ·åºŠæ™‚åˆ»
    weekdayBedtimeAvg: Date,
    weekendBedtimeAvg: Date
) -> Int {
    // å°±å¯æ™‚åˆ»å®‰å®šåº¦ (35ç‚¹)
    let bedtimeStdDev = calculateStandardDeviation(
        bedtimes.map { $0.timeIntervalSince1970 }
    )
    let bedtimeStabilityScore = max(0, 35 - (bedtimeStdDev / 60 / 30) * 35)

    // èµ·åºŠæ™‚åˆ»å®‰å®šåº¦ (35ç‚¹)
    let wakeupStdDev = calculateStandardDeviation(
        wakeups.map { $0.timeIntervalSince1970 }
    )
    let wakeupStabilityScore = max(0, 35 - (wakeupStdDev / 60 / 30) * 35)

    // é€±æœ«ã‚·ãƒ•ãƒˆ (20ç‚¹)
    let weekendShiftMinutes = abs(
        weekdayBedtimeAvg.timeIntervalSince(weekendBedtimeAvg)
    ) / 60
    let weekendShiftScore = max(0, 20 - (weekendShiftMinutes / 60) * 10)

    // ç†æƒ³æ™‚é–“å¸¯ (10ç‚¹)
    let idealRangeScore = calculateIdealRangeScore(
        bedtimes: bedtimes,
        wakeups: wakeups
    )

    return Int(
        bedtimeStabilityScore +
        wakeupStabilityScore +
        weekendShiftScore +
        idealRangeScore
    )
}
```

### 3.3 24 æ™‚é–“ã‚µãƒ¼ã‚¯ãƒ«å›³

#### ä»•æ§˜

| é …ç›®       | å€¤                            |
| ---------- | ----------------------------- |
| å½¢å¼       | å††å½¢ã‚°ãƒ©ãƒ•ï¼ˆæ™‚è¨ˆå‹ï¼‰          |
| æ™‚é–“ç¯„å›²   | 00:00 - 24:00                 |
| è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿ | éå» 7 æ—¥é–“ã®å°±å¯ãƒ»èµ·åºŠæ™‚åˆ»   |
| è‰²åˆ†ã‘     | ç¡çœ æ™‚é–“å¸¯ã‚’å¡—ã‚Šã¤ã¶ã—        |
| ä¸­å¤®è¡¨ç¤º   | æ˜¨å¤œã®å°±å¯ãƒ»èµ·åºŠæ™‚åˆ» + ã‚¹ã‚³ã‚¢ |

#### ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«æ§‹é€ 

```
        12:00 (æ˜¼)
           â”‚
   9:00 â”€â”€â”€â”¼â”€â”€â”€ 15:00
           â”‚
  6:00 â”€â”€â”€â”€â—â”€â”€â”€â”€ 18:00  â— = èµ·åºŠæ™‚åˆ»ï¼ˆä»Šæœï¼‰
           â”‚
   3:00 â”€â”€â”€â”¼â”€â”€â”€ 21:00
           â”‚
   0:00  â”€â”€â—â”€â”€  24:00   â— = å°±å¯æ™‚åˆ»ï¼ˆæ˜¨å¤œï¼‰
     (æ·±å¤œ)

ä¸­å¤®è¡¨ç¤º:
  å°±å¯ 23:15
  èµ·åºŠ  7:05
  ã‚¹ã‚³ã‚¢ 78
  å®‰å®š
```

#### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```swift
struct CircadianCircleData {
    let date: Date
    let bedtimes: [CircularTimePoint]      // éå»7æ—¥ã®å°±å¯æ™‚åˆ»
    let wakeups: [CircularTimePoint]       // éå»7æ—¥ã®èµ·åºŠæ™‚åˆ»
    let todayBedtime: CircularTimePoint    // æ˜¨å¤œã®å°±å¯æ™‚åˆ»ï¼ˆå¼·èª¿ï¼‰
    let todayWakeup: CircularTimePoint     // ä»Šæœã®èµ·åºŠæ™‚åˆ»ï¼ˆå¼·èª¿ï¼‰
    let score: Int                         // ãƒªã‚ºãƒ ã‚¹ã‚³ã‚¢
    let status: String                     // ã€Œå®‰å®šã€ã€Œã‚„ã‚„ä¸è¦å‰‡ã€ãªã©
}

struct CircularTimePoint {
    let date: Date
    let angle: Double  // 0-360åº¦ï¼ˆ0åº¦=0:00, 180åº¦=12:00ï¼‰
    let isToday: Bool  // ä»Šæ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‹ã©ã†ã‹
}

extension Date {
    // æ™‚åˆ»ã‚’è§’åº¦ã«å¤‰æ›ï¼ˆ0:00 = 0åº¦ã€12:00 = 180åº¦ï¼‰
    var circularAngle: Double {
        let calendar = Calendar.current
        let hour = calendar.component(.hour, from: self)
        let minute = calendar.component(.minute, from: self)
        let totalMinutes = Double(hour * 60 + minute)
        return (totalMinutes / 1440.0) * 360.0  // 1440åˆ† = 24æ™‚é–“
    }
}
```

#### è‰²æŒ‡å®š

| è¦ç´                | è‰²                   | ç”¨é€”              |
| ------------------ | -------------------- | ----------------- |
| ã‚µãƒ¼ã‚¯ãƒ«å¤–æ        | Secondary Text       | æ™‚è¨ˆã®ç›®ç››ã‚Š      |
| éå»ã®å°±å¯æ™‚åˆ»     | Primary (è–„ã‚)       | å°ã•ã„ç‚¹          |
| éå»ã®èµ·åºŠæ™‚åˆ»     | Primary (è–„ã‚)       | å°ã•ã„ç‚¹          |
| ä»Šæ—¥ã®å°±å¯æ™‚åˆ»     | Primary              | å¤§ãã„ç‚¹          |
| ä»Šæ—¥ã®èµ·åºŠæ™‚åˆ»     | Primary              | å¤§ãã„ç‚¹          |
| ç¡çœ æ™‚é–“å¸¯         | Primary (é€æ˜åº¦ 30%) | å¡—ã‚Šã¤ã¶ã—        |
| ç†æƒ³çš„ãªç¡çœ æ™‚é–“å¸¯ | Yellow (é€æ˜åº¦ 15%)  | 22:00-6:00 ã®ç¯„å›² |

### 3.4 ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ãƒˆãƒƒãƒ—ã§ã®è¡¨ç¤º

**å¤§ã‚«ãƒ¼ãƒ‰æ§‹æˆ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ• ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ             â”‚
â”‚                                    â”‚
â”‚     [24æ™‚é–“ã‚µãƒ¼ã‚¯ãƒ«å›³]              â”‚
â”‚                                    â”‚
â”‚   å°±å¯ 23:15  èµ·åºŠ 7:05            â”‚
â”‚   ãƒªã‚ºãƒ ã‚¹ã‚³ã‚¢: 78                 â”‚
â”‚   å®‰å®š âœ“                           â”‚
â”‚                                    â”‚
â”‚        [è©³ã—ãè¦‹ã‚‹ >]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å°ã‚«ãƒ¼ãƒ‰æ§‹æˆï¼ˆå‚è€ƒï¼‰**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [icon]  â”‚
â”‚ ãƒªã‚ºãƒ   â”‚  â† å‰Šé™¤ï¼ˆå¤§ã‚«ãƒ¼ãƒ‰ã«çµ±åˆï¼‰
â”‚  78     â”‚
â”‚ å®‰å®š    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 ãƒªã‚ºãƒ è©³ç´°ç”»é¢

**ç”»é¢æ§‹æˆ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚         [78]                    â”‚
â”‚         ã‚¹ã‚³ã‚¢                  â”‚
â”‚         å®‰å®š                    â”‚
â”‚                                 â”‚
â”‚  å¹³å‡å°±å¯: 23:30                â”‚
â”‚  å¹³å‡èµ·åºŠ: 7:15                 â”‚
â”‚  ãƒªã‚ºãƒ å®‰å®šåº¦: è‰¯å¥½              â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  [24æ™‚é–“ã‚µãƒ¼ã‚¯ãƒ«å›³ãƒ»è©³ç´°ç‰ˆ]  â”‚ â”‚
â”‚ â”‚                             â”‚ â”‚
â”‚ â”‚  éå»7æ—¥åˆ†ã®å°±å¯ãƒ»èµ·åºŠãƒ—ãƒ­ãƒƒãƒˆâ”‚ â”‚
â”‚ â”‚  ç†æƒ³çš„ãªç¡çœ æ™‚é–“å¸¯ã‚’è¡¨ç¤º    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ ğŸ“Š é€±é–“ãƒˆãƒ¬ãƒ³ãƒ‰                  â”‚
â”‚                                 â”‚
â”‚ å°±å¯æ™‚åˆ»                        â”‚
â”‚ [æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•]                  â”‚
â”‚                                 â”‚
â”‚ èµ·åºŠæ™‚åˆ»                        â”‚
â”‚ [æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•]                  â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ ğŸ“ˆ ã‚¹ã‚³ã‚¢å†…è¨³                    â”‚
â”‚                                 â”‚
â”‚ å°±å¯æ™‚åˆ»å®‰å®šåº¦ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 28/35  â”‚
â”‚ èµ·åºŠæ™‚åˆ»å®‰å®šåº¦ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 29/35  â”‚
â”‚ é€±æœ«ã‚·ãƒ•ãƒˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 15/20  â”‚
â”‚ ç†æƒ³æ™‚é–“å¸¯    â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  6/10  â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ ğŸ’¡ ãƒªã‚ºãƒ ã‚’æ•´ãˆã‚‹ãƒ’ãƒ³ãƒˆ          â”‚
â”‚                                 â”‚
â”‚ â€¢ æ¯æ—¥åŒã˜æ™‚é–“ã«èµ·ãã‚‹          â”‚
â”‚ â€¢ æœã®å…‰ã‚’æµ´ã³ã‚‹ï¼ˆèµ·åºŠå¾Œ30åˆ†ä»¥å†…ï¼‰â”‚
â”‚ â€¢ é€±æœ«ã‚‚å¹³æ—¥ã¨åŒã˜ãƒªã‚ºãƒ ã§      â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.6 æ”¹å–„ã®ãƒ’ãƒ³ãƒˆï¼ˆæ¡ä»¶åˆ†å²ï¼‰

| æ¡ä»¶                                  | ãƒ’ãƒ³ãƒˆ                                               |
| ------------------------------------- | ---------------------------------------------------- |
| å°±å¯ãŒé…ã„ï¼ˆå¹³å‡ > 24:00ï¼‰            | ã€Œå°±å¯ã‚’æ¯æ—¥ 15-30 åˆ†ãšã¤æ—©ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€          |
| å°±å¯æ™‚åˆ»ã®ã°ã‚‰ã¤ãå¤§ï¼ˆSD > 60 åˆ†ï¼‰    | ã€Œæ¯æ—¥åŒã˜æ™‚é–“ã«å¯ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€           |
| é€±æœ«ã‚·ãƒ•ãƒˆã‚ã‚Šï¼ˆå¹³æ—¥ã¨ 2 æ™‚é–“ä»¥ä¸Šå·®ï¼‰ | ã€Œé€±æœ«ã‚‚å¹³æ—¥ã¨åŒã˜æ™‚é–“ã«èµ·ãã‚‹ç¿’æ…£ã‚’ã¤ã‘ã¾ã—ã‚‡ã†ã€   |
| èµ·åºŠæ™‚åˆ»ãŒé…ã„ï¼ˆå¹³å‡ > 8:00ï¼‰         | ã€Œèµ·åºŠæ™‚åˆ»ã‚’å°‘ã—ãšã¤æ—©ã‚ã¦ã€æœã®å…‰ã‚’æµ´ã³ã¾ã—ã‚‡ã†ã€   |
| ç†æƒ³æ™‚é–“å¸¯å¤–                          | ã€Œ22:00-24:00 ã®å°±å¯ã€6:00-8:00 ã®èµ·åºŠãŒç†æƒ³çš„ã§ã™ã€ |

---

## 4. ç¡çœ ã‚¹ã‚³ã‚¢

### 4.1 ã‚¹ã‚³ã‚¢ç®—å‡ºï¼ˆ0-100ï¼‰

```
ç·åˆã‚¹ã‚³ã‚¢ = ç¡çœ æ™‚é–“(35) + æ·±ã„ç¡çœ (25) + REMç¡çœ (15) + ç¡çœ åŠ¹ç‡(15) + å°±å¯ã‚¿ã‚¤ãƒŸãƒ³ã‚°(10)
```

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | é…ç‚¹  | ç®—å‡ºæ–¹æ³•                                       |
| -------------- | ----- | ---------------------------------------------- |
| ç¡çœ æ™‚é–“       | 35 ç‚¹ | 7-9 æ™‚é–“ = æº€ç‚¹ã€6 æ™‚é–“ä»¥ä¸‹/-1 æ™‚é–“ã”ã¨ã«-7 ç‚¹ |
| æ·±ã„ç¡çœ        | 25 ç‚¹ | ç·ç¡çœ æ™‚é–“ã® 15-20% = æº€ç‚¹                     |
| REM ç¡çœ        | 15 ç‚¹ | ç·ç¡çœ æ™‚é–“ã® 20-25% = æº€ç‚¹                     |
| ç¡çœ åŠ¹ç‡       | 15 ç‚¹ | (å®Ÿç¡çœ æ™‚é–“/ãƒ™ãƒƒãƒ‰æ™‚é–“) Ã— 100ã€90%ä»¥ä¸Š = æº€ç‚¹  |
| å°±å¯ã‚¿ã‚¤ãƒŸãƒ³ã‚° | 10 ç‚¹ | ç†æƒ³æ™‚é–“å¸¯(22:00-24:00)ã‹ã‚‰ã®ä¹–é›¢ã§æ¸›ç‚¹        |

#### ç®—å‡ºã‚³ãƒ¼ãƒ‰

```swift
func calculateSleepScore(
    totalSleepMinutes: Int,
    deepSleepMinutes: Int,
    remSleepMinutes: Int,
    timeInBedMinutes: Int,
    bedtimeHour: Int
) -> Int {
    // ç¡çœ æ™‚é–“ã‚¹ã‚³ã‚¢ (35ç‚¹)
    let sleepHours = Double(totalSleepMinutes) / 60.0
    let durationScore: Double
    if sleepHours >= 7 && sleepHours <= 9 {
        durationScore = 35
    } else if sleepHours < 7 {
        durationScore = max(0, 35 - (7 - sleepHours) * 7)
    } else {
        durationScore = max(0, 35 - (sleepHours - 9) * 5)
    }

    // æ·±ã„ç¡çœ ã‚¹ã‚³ã‚¢ (25ç‚¹)
    let deepSleepRatio = Double(deepSleepMinutes) / Double(totalSleepMinutes)
    let deepSleepScore = min(25, deepSleepRatio / 0.175 * 25)

    // REMç¡çœ ã‚¹ã‚³ã‚¢ (15ç‚¹)
    let remRatio = Double(remSleepMinutes) / Double(totalSleepMinutes)
    let remScore = min(15, remRatio / 0.225 * 15)

    // ç¡çœ åŠ¹ç‡ã‚¹ã‚³ã‚¢ (15ç‚¹)
    let efficiency = Double(totalSleepMinutes) / Double(timeInBedMinutes)
    let efficiencyScore = min(15, efficiency / 0.9 * 15)

    // å°±å¯ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚¹ã‚³ã‚¢ (10ç‚¹)
    let idealBedtime = 23
    let timingDiff = abs(bedtimeHour - idealBedtime)
    let timingScore = max(0, 10 - timingDiff * 3)

    return Int(durationScore + deepSleepScore + remScore + efficiencyScore + Double(timingScore))
}
```

---

## 5. HRV ã‚¹ã‚³ã‚¢

### 5.1 ã‚¹ã‚³ã‚¢ç®—å‡ºï¼ˆ0-100ï¼‰

```
ç·åˆã‚¹ã‚³ã‚¢ = å€‹äººãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¯”è¼ƒ(50) + 7æ—¥ãƒˆãƒ¬ãƒ³ãƒ‰(25) + å®‰é™æ™‚å¿ƒæ‹æ•°(25)
```

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ       | é…ç‚¹  | ç®—å‡ºæ–¹æ³•                               |
| -------------------- | ----- | -------------------------------------- |
| å€‹äººãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¯”è¼ƒ | 50 ç‚¹ | éå» 30 æ—¥å¹³å‡ã¨ã®æ¯”è¼ƒã€Â±20%ä»¥å†…ã§æº€ç‚¹ |
| 7 æ—¥ãƒˆãƒ¬ãƒ³ãƒ‰         | 25 ç‚¹ | 7 æ—¥é–“ã®å¤‰åŒ–å‚¾å‘ã€ä¸Šæ˜‡å‚¾å‘ã§åŠ ç‚¹       |
| å®‰é™æ™‚å¿ƒæ‹æ•°         | 25 ç‚¹ | å€‹äººã®å®‰é™æ™‚å¿ƒæ‹æ•°ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¨ã®æ¯”è¼ƒ |

#### ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³è¨ˆç®—

```swift
struct HRVBaseline {
    let average30Day: Double
    let standardDeviation: Double
    let restingHeartRate: Double
}

func calculateHRVScore(
    currentHRV: Double,
    baseline: HRVBaseline,
    last7Days: [Double]
) -> Int {
    // ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¯”è¼ƒã‚¹ã‚³ã‚¢ (50ç‚¹)
    let deviationRatio = (currentHRV - baseline.average30Day) / baseline.average30Day
    let baselineScore: Double
    if abs(deviationRatio) <= 0.2 {
        baselineScore = 50
    } else if deviationRatio > 0.2 {
        baselineScore = min(50, 50 + deviationRatio * 25)
    } else {
        baselineScore = max(0, 50 + deviationRatio * 100)
    }

    // 7æ—¥ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¹ã‚³ã‚¢ (25ç‚¹)
    let trend = calculateTrend(last7Days)
    let trendScore: Double
    switch trend {
    case .improving: trendScore = 25
    case .stable: trendScore = 20
    case .declining: trendScore = 10
    }

    // å®‰é™æ™‚å¿ƒæ‹æ•°ã‚¹ã‚³ã‚¢ (25ç‚¹)
    let restingHRScore = 25.0

    return Int(baselineScore + trendScore + restingHRScore)
}
```

---

## 6. æ´»å‹•é‡ã‚¹ã‚³ã‚¢

### 6.1 ã‚¹ã‚³ã‚¢ç®—å‡ºï¼ˆ0-100ï¼‰

```
ç·åˆã‚¹ã‚³ã‚¢ = æ­©æ•°(40) + ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚é–“(30) + åº§ã‚Šã£ã±ãªã—å›é¿(20) + é‹å‹•å®Œäº†(10)
```

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ   | é…ç‚¹  | ç®—å‡ºæ–¹æ³•                                      |
| ---------------- | ----- | --------------------------------------------- |
| æ­©æ•°             | 40 ç‚¹ | ç›®æ¨™æ­©æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 8,000 æ­©ï¼‰ã«å¯¾ã™ã‚‹é”æˆç‡ |
| ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚é–“   | 30 ç‚¹ | ä¸­ã€œé«˜å¼·åº¦æ´»å‹•æ™‚é–“ã€30 åˆ†ä»¥ä¸Šã§æº€ç‚¹           |
| åº§ã‚Šã£ã±ãªã—å›é¿ | 20 ç‚¹ | 1 æ™‚é–“ä»¥ä¸Šã®é€£ç¶šåº§ä½å›é¿                      |
| é‹å‹•å®Œäº†         | 10 ç‚¹ | è¨­å®šã—ãŸé‹å‹•ç›®æ¨™ã®é”æˆ                        |

#### ç®—å‡ºã‚³ãƒ¼ãƒ‰

```swift
func calculateActivityScore(
    steps: Int,
    targetSteps: Int = 8000,
    activeMinutes: Int,
    sedentaryBreaks: Int,
    exerciseCompleted: Bool
) -> Int {
    // æ­©æ•°ã‚¹ã‚³ã‚¢ (40ç‚¹)
    let stepRatio = Double(steps) / Double(targetSteps)
    let stepsScore = min(40, stepRatio * 40)

    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚é–“ã‚¹ã‚³ã‚¢ (30ç‚¹)
    let activeScore = min(30, Double(activeMinutes) / 30.0 * 30)

    // åº§ã‚Šã£ã±ãªã—å›é¿ã‚¹ã‚³ã‚¢ (20ç‚¹)
    let sedentaryScore = min(20, Double(sedentaryBreaks) / 16.0 * 20)

    // é‹å‹•å®Œäº†ã‚¹ã‚³ã‚¢ (10ç‚¹)
    let exerciseScore = exerciseCompleted ? 10 : 0

    return Int(stepsScore + activeScore + sedentaryScore + Double(exerciseScore))
}
```

---

## 7. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®š

### 7.1 å…±é€šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

å…¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«å…±é€šã™ã‚‹åˆ¤å®šãƒ«ãƒ¼ãƒ«:

| ã‚¹ã‚³ã‚¢ç¯„å›² | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | è‰²                |
| ---------- | ---------- | ----------------- |
| 80-100     | æœ€é«˜       | Primary (#7CB342) |
| 60-79      | è‰¯å¥½       | Primary (#7CB342) |
| 40-59      | æ™®é€š       | Yellow (#FFC107)  |
| 20-39      | ã‚„ã‚„ä½ä¸‹   | Orange (#FF9800)  |
| 0-19       | è¦æ”¹å–„     | Red (#F44336)     |

### 7.2 åˆ¤å®šé–¢æ•°

```swift
enum MetricStatus: String {
    case excellent = "æœ€é«˜"
    case good = "è‰¯å¥½"
    case fair = "æ™®é€š"
    case low = "ã‚„ã‚„ä½ä¸‹"
    case poor = "è¦æ”¹å–„"

    static func from(score: Int) -> MetricStatus {
        switch score {
        case 80...100: return .excellent
        case 60..<80: return .good
        case 40..<60: return .fair
        case 20..<40: return .low
        default: return .poor
        }
    }

    var color: Color {
        switch self {
        case .excellent, .good: return .primaryGreen
        case .fair: return .yellow
        case .low: return .orange
        case .poor: return .red
        }
    }
}
```

---

## 8. ãƒ‡ãƒ¼ã‚¿è¦ä»¶

### 8.1 å¿…è¦ãª HealthKit ãƒ‡ãƒ¼ã‚¿

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹     | HealthKit Type                            | å¿…é ˆ/ä»»æ„ |
| -------------- | ----------------------------------------- | --------- |
| ç¡çœ            | HKCategoryType(.sleepAnalysis)            | å¿…é ˆ      |
| æ·±ã„ç¡çœ        | HKCategoryValueSleepAnalysis.asleepDeep   | ä»»æ„      |
| REM ç¡çœ        | HKCategoryValueSleepAnalysis.asleepREM    | ä»»æ„      |
| HRV            | HKQuantityType(.heartRateVariabilitySDNN) | å¿…é ˆ      |
| å¿ƒæ‹æ•°         | HKQuantityType(.heartRate)                | å¿…é ˆ      |
| æ­©æ•°           | HKQuantityType(.stepCount)                | å¿…é ˆ      |
| ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚é–“ | HKQuantityType(.appleExerciseTime)        | ä»»æ„      |

### 8.2 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†

| ãƒ‡ãƒ¼ã‚¿ä¸è¶³            | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯                             |
| --------------------- | ------------------------------------------ |
| æ·±ã„ç¡çœ /REM ç¡çœ ãªã— | ç·ç¡çœ æ™‚é–“ã‹ã‚‰æ¨å®šï¼ˆæ·±ã„ç¡çœ  17%ã€REM22%ï¼‰ |
| HRV ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ãªã—  | åˆå›ã¯çµ¶å¯¾å€¤ã§åˆ¤å®šã€2 é€±é–“å¾Œã‹ã‚‰ç›¸å¯¾è©•ä¾¡   |
| æ´»å‹•é‡ãƒ‡ãƒ¼ã‚¿ä¸€éƒ¨æ¬ æ  | å–å¾—ã§ããŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã¿ã§æŒ‰åˆ†è¨ˆç®—     |

### 8.3 æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹           | æ›´æ–°é »åº¦     | ãƒˆãƒªã‚¬ãƒ¼                        |
| -------------------- | ------------ | ------------------------------- |
| ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ  | 1 æ—¥ 1 å›    | ç¡çœ ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ™‚                |
| ç¡çœ                  | 1 æ—¥ 1 å›    | èµ·åºŠæ¤œçŸ¥æ™‚                      |
| HRV                  | 1 æ—¥ 1 å›    | èµ·åºŠå¾Œã®å®‰é™æ™‚ HRV å–å¾—æ™‚       |
| æ´»å‹•é‡               | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  | 15 åˆ†ã”ã¨ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ›´æ–° |

---

## 9. è¦å› ã®è²¢çŒ®åº¦ç®—å‡º

### 9.1 æ¦‚è¦

ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ç”»é¢ã®ã€Œè¦å› ãƒãƒƒãƒ—ã€ã§è¡¨ç¤ºã™ã‚‹ã€å„è¦å› ï¼ˆç¡çœ ãƒ»ç’°å¢ƒãƒ»æ´»å‹•ï¼‰ã®è²¢çŒ®åº¦ã‚’ç®—å‡ºã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã€‚

### 9.2 è²¢çŒ®åº¦ãƒ¬ãƒ™ãƒ«

| ãƒ¬ãƒ™ãƒ« | è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ | å†…éƒ¨å€¤ |
|--------|-------------|--------|
| highPositive | å›å¾©ã«å¤§ããè²¢çŒ® | 5 |
| positive | å›å¾©ã«è²¢çŒ® | 4 |
| neutral | å½±éŸ¿å°‘ãªã‚ | 3 |
| negative | ã‚„ã‚„è² è·ã‚ã‚Š | 2 |
| highNegative | è² è·ã‚ã‚Š | 1 |

### 9.3 ç¡çœ ã®è²¢çŒ®åº¦

```swift
func calculateSleepContribution(
    sleepHours: Double,
    deepSleepMinutes: Int,
    avg7dSleepHours: Double
) -> ContributionLevel {
    // ç¡çœ æ™‚é–“ã¨7æ—¥å¹³å‡ã¨ã®å·®åˆ†ã‚’è€ƒæ…®
    let sleepDelta = (sleepHours - avg7dSleepHours) / avg7dSleepHours

    if sleepHours >= 7 && sleepDelta >= 0.1 {
        return .highPositive  // 7æ™‚é–“ä»¥ä¸Š ã‹ã¤ å¹³å‡ã‚ˆã‚Š10%ä»¥ä¸Šå¤šã„
    }
    if sleepHours >= 7 {
        return .positive      // 7æ™‚é–“ä»¥ä¸Š
    }
    if sleepHours >= 6 {
        return .neutral       // 6-7æ™‚é–“
    }
    if sleepHours >= 5 {
        return .negative      // 5-6æ™‚é–“
    }
    return .highNegative      // 5æ™‚é–“æœªæº€
}
```

**è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆä¾‹:**
- ã€Œ7.2h / æ·±ã„ç¡çœ  1.8hã€
- ã€Œ5.5h / æ·±ã„ç¡çœ ãŒä¸è¶³ã€

### 9.4 ç’°å¢ƒã®è²¢çŒ®åº¦

```swift
func calculateEnvironmentContribution(
    pressureHpa: Int,
    pressureChange6h: Int,  // éå»6æ™‚é–“ã®å¤‰åŒ–é‡
    tempC: Int
) -> ContributionLevel {
    // æ°—åœ§ã®å¤‰åŒ–é‡ã‚’ä¸»ã«è©•ä¾¡
    let absChange = abs(pressureChange6h)

    if absChange <= 3 && pressureHpa >= 1010 && pressureHpa <= 1025 {
        return .positive      // å®‰å®šã—ãŸé«˜æ°—åœ§
    }
    if absChange <= 5 {
        return .neutral       // å°ã•ãªå¤‰åŒ–
    }
    if absChange <= 10 {
        return .negative      // ä¸­ç¨‹åº¦ã®å¤‰åŒ–
    }
    return .highNegative      // å¤§ããªå¤‰åŒ–ï¼ˆä½æ°—åœ§æ¥è¿‘ãªã©ï¼‰
}
```

**è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆä¾‹:**
- ã€Œæ™´ã‚Œ 12Â°C / æ°—åœ§å®‰å®šã€
- ã€Œåˆå¾Œã‹ã‚‰ä½æ°—åœ§ (1008hPa)ã€
- ã€Œæ°—åœ§å¤‰åŒ–å¤§ (-15hPa)ã€

### 9.5 æ´»å‹•ã®è²¢çŒ®åº¦

```swift
func calculateActivityContribution(
    stepsYesterday: Int,
    avg7dSteps: Int,
    activeMinutes: Int
) -> ContributionLevel {
    let stepRatio = Double(stepsYesterday) / Double(avg7dSteps)

    // é©åº¦ãªæ´»å‹•é‡ãŒæœ€ã‚‚è‰¯ã„ï¼ˆéå‰°ã‚‚ä¸è¶³ã‚‚ãƒã‚¤ãƒŠã‚¹ï¼‰
    if stepRatio >= 0.8 && stepRatio <= 1.3 && activeMinutes >= 20 {
        return .positive      // é©åº¦
    }
    if stepRatio >= 0.5 && stepRatio <= 1.5 {
        return .neutral       // ã‚„ã‚„éä¸è¶³
    }
    if stepRatio < 0.5 {
        return .negative      // æ´»å‹•ä¸è¶³
    }
    return .negative          // éå‰°ãªæ´»å‹•
}
```

**è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆä¾‹:**
- ã€Œæ˜¨æ—¥ 8,200æ­© / æ´»å‹•çš„ãª1æ—¥ã€
- ã€Œæ˜¨æ—¥ 4,200æ­© / è»½ã‚ã®1æ—¥ã€
- ã€Œæ˜¨æ—¥ 2,100æ­© / æ´»å‹•é‡å°‘ãªã‚ã€

---

## 10. ã€Œã‚ãªãŸã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã®ç›¸é–¢åˆ†æ

### 10.1 æ¦‚è¦

è©³ç´°ç”»é¢ã§è¡¨ç¤ºã™ã‚‹ã€Œã‚ãªãŸã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å› æœé–¢ä¿‚ã‚’ç™ºè¦‹ã—ã€æ•£å¸ƒå›³ã¨ã‚¤ãƒ³ã‚µã‚¤ãƒˆæ–‡ã§å¯è¦–åŒ–ã™ã‚‹æ©Ÿèƒ½ã€‚

### 10.2 è¡¨ç¤ºæ¡ä»¶

- **æœ€ä½ãƒ‡ãƒ¼ã‚¿é‡**: 14æ—¥ä»¥ä¸Š
- **å„ç¾¤ã®æœ€ä½ã‚µãƒ³ãƒ—ãƒ«æ•°**: 5æ—¥ä»¥ä¸Š
- **æœ€ä½å·®åˆ†**: 10%ä»¥ä¸Š

### 10.3 åˆ†æå¯¾è±¡ãƒ‘ã‚¿ãƒ¼ãƒ³

| å„ªå…ˆåº¦ | ãƒ‘ã‚¿ãƒ¼ãƒ³ | Xè»¸ | Yè»¸ | é–¾å€¤ |
|--------|----------|-----|-----|------|
| 1 | ç¡çœ æ™‚é–“ â†’ HRV | ç¡çœ æ™‚é–“ | ç¿Œæœã®HRV | 7æ™‚é–“ |
| 2 | å°±å¯æ™‚åˆ» â†’ HRV | å°±å¯æ™‚åˆ» | ç¿Œæœã®HRV | 23:30 |
| 3 | æ­©æ•° â†’ æ·±ã„ç¡çœ  | æ­©æ•° | æ·±ã„ç¡çœ æ™‚é–“ | 6,000æ­© |

### 10.4 ç®—å‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```swift
struct PatternInsight {
    let patternType: PatternType
    let threshold: Double
    let differencePercent: Double
    let description: String
}

enum PatternType {
    case sleepToHRV
    case bedtimeToHRV
    case stepsToDeepSleep
}

func analyzePatterns(dailyData: [DailyHealthData]) -> PatternInsight? {
    // ãƒ‡ãƒ¼ã‚¿ãŒ14æ—¥æœªæº€ã®å ´åˆã¯nil
    guard dailyData.count >= 14 else { return nil }

    // å„ªå…ˆåº¦é †ã«ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æ
    let patterns: [(PatternType, Double)] = [
        (.sleepToHRV, 7.0),
        (.bedtimeToHRV, 23.5),  // 23:30 = 23.5
        (.stepsToDeepSleep, 6000)
    ]

    var bestInsight: PatternInsight? = nil
    var maxDifference: Double = 0

    for (patternType, threshold) in patterns {
        if let insight = analyzePattern(
            dailyData: dailyData,
            patternType: patternType,
            threshold: threshold
        ) {
            if abs(insight.differencePercent) > maxDifference {
                maxDifference = abs(insight.differencePercent)
                bestInsight = insight
            }
        }
    }

    // å·®ãŒ10%æœªæº€ã®å ´åˆã¯nil
    guard maxDifference >= 10 else { return nil }

    return bestInsight
}

func analyzePattern(
    dailyData: [DailyHealthData],
    patternType: PatternType,
    threshold: Double
) -> PatternInsight? {
    // ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦Xå€¤ã¨Yå€¤ã‚’æŠ½å‡º
    let xyPairs: [(x: Double, y: Double)] = dailyData.compactMap { data in
        switch patternType {
        case .sleepToHRV:
            guard let hrv = data.nextMorningHRV else { return nil }
            return (data.sleepHours, hrv)
        case .bedtimeToHRV:
            guard let hrv = data.nextMorningHRV else { return nil }
            return (data.bedtimeHour, hrv)
        case .stepsToDeepSleep:
            return (Double(data.steps), Double(data.deepSleepMinutes))
        }
    }

    // é–¾å€¤ã§2ç¾¤ã«åˆ†ã‘ã‚‹
    let aboveThreshold = xyPairs.filter { $0.x >= threshold }
    let belowThreshold = xyPairs.filter { $0.x < threshold }

    // å„ç¾¤ã«5æ—¥ä»¥ä¸Šå¿…è¦
    guard aboveThreshold.count >= 5, belowThreshold.count >= 5 else {
        return nil
    }

    // å„ç¾¤ã®Yå¹³å‡ã‚’è¨ˆç®—
    let avgY_above = aboveThreshold.map { $0.y }.reduce(0, +) / Double(aboveThreshold.count)
    let avgY_below = belowThreshold.map { $0.y }.reduce(0, +) / Double(belowThreshold.count)

    // å·®åˆ†ã‚’%ã§ç®—å‡º
    let difference = ((avgY_above - avgY_below) / avgY_below) * 100

    // ã‚¤ãƒ³ã‚µã‚¤ãƒˆæ–‡ã‚’ç”Ÿæˆ
    let description = generateInsightText(
        patternType: patternType,
        threshold: threshold,
        difference: difference
    )

    return PatternInsight(
        patternType: patternType,
        threshold: threshold,
        differencePercent: difference,
        description: description
    )
}

func generateInsightText(
    patternType: PatternType,
    threshold: Double,
    difference: Double
) -> String {
    let diffText = difference > 0 ? "é«˜ã„" : "ä½ã„"
    let diffPercent = Int(abs(difference))

    switch patternType {
    case .sleepToHRV:
        return "\(Int(threshold))æ™‚é–“ä»¥ä¸Šçœ ã£ãŸæ—¥ã¯ã€HRVãŒå¹³å‡\(diffPercent)%\(diffText)å‚¾å‘ãŒã‚ã‚Šã¾ã™"
    case .bedtimeToHRV:
        let hour = Int(threshold)
        let minute = Int((threshold - Double(hour)) * 60)
        return "\(hour):\(String(format: "%02d", minute))å‰ã«å°±å¯ã—ãŸæ—¥ã¯ã€HRVãŒå¹³å‡\(diffPercent)%\(diffText)å‚¾å‘ãŒã‚ã‚Šã¾ã™"
    case .stepsToDeepSleep:
        return "\(Int(threshold).formatted())æ­©ä»¥ä¸Šæ­©ã„ãŸæ—¥ã¯ã€æ·±ã„ç¡çœ ãŒå¹³å‡\(diffPercent)%\(diffText)å‚¾å‘ãŒã‚ã‚Šã¾ã™"
    }
}
```

### 10.5 æ•£å¸ƒå›³ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```swift
struct ScatterPlotData {
    let points: [ScatterPoint]
    let xAxisLabel: String
    let yAxisLabel: String
    let thresholdLine: Double?
}

struct ScatterPoint {
    let x: Double
    let y: Double
    let date: Date
}
```

---

## æ”¹è¨‚å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜       | å¤‰æ›´å†…å®¹                                                                                                                                                |
| ---------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1.0        | 2025-12-13 | åˆç‰ˆä½œæˆï¼ˆmetrics-algorithm-spec.md + correlation-analysis-spec.mdï¼‰                                                                                    |
| 2.0        | 2025-12-19 | çµ±åˆç‰ˆä½œæˆã€‚ã‚µãƒ¼ã‚«ãƒ‡ã‚£ã‚¢ãƒ³ãƒªã‚ºãƒ è©³ç´°è¿½åŠ ï¼ˆ24 æ™‚é–“ã‚µãƒ¼ã‚¯ãƒ«å›³ã€å¤§ã‚«ãƒ¼ãƒ‰ä»•æ§˜ï¼‰ã€‚ã‚¹ãƒˆãƒ¬ã‚¹ã‚’ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ã—ã¦æ˜ç¢ºåŒ–ã€‚ç›¸é–¢åˆ†æã‚’å‰Šé™¤ï¼ˆå°†æ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å»¶æœŸï¼‰ã€‚ |
| 3.0        | 2025-12-19 | ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ç”»é¢ãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«å¯¾å¿œã€‚ã‚¹ãƒˆãƒ¬ã‚¹ã‚¹ã‚³ã‚¢ã‚’å‰Šé™¤ï¼ˆHRVã«çµ±åˆï¼‰ã€‚è¦å› ã®è²¢çŒ®åº¦ç®—å‡ºã€ç›¸é–¢åˆ†æã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’è¿½åŠ ã€‚ |

---

**ä»¥ä¸Šã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹ä»•æ§˜æ›¸ v3.0**
