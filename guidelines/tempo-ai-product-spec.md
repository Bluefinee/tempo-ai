# Tempo AI プロダクト仕様書 (Ver 2.0)

## Product Specification Document

### 概要 (Overview)

Tempo AI は、**"Your Life Pacer"（人生のペースメーカー）** をコンセプトとする次世代の健康管理アプリケーションです。
従来の「健康スコア」という静的な指標を廃止し、**「ヒューマンバッテリー（Human Battery）」** という動的なエネルギー概念を導入。HealthKit の生体データと Open-Meteo の気象データを統合し、ユーザーの目的（モード）と関心事（タグ）に合わせて、**「今、休むべきか、攻めるべきか」** を瞬時に判断できる「デジタル・コックピット」を提供します。

---

## 1. UX コンセプト (UX Concept)

### 1.1 結論ファースト (The Answer First)

ユーザーがアプリを開いて 0.5 秒で行動指針を理解できる UI 設計を徹底します。
データの羅列ではなく、**「ヘッドライン（結論）」→「バッテリー（現状）」→「根拠（データ）」** の順で情報を提示します。

### 1.2 共感的AIパートナー (The Empathetic AI Partner)

Tempo AI は単なる分析ツールではなく、**「見えない現実を理解する賢いパートナー」** として機能します。

#### A. ユーザー体験の三原則

1. **Permission-Granting (許可を与える)**
   - 高バッテリー: "今日は全力で行く**許可**が出ています"
   - 低バッテリー: "堂々と休む**権利**があります"
   - 義務ではなく、解放感を与える表現を徹底

2. **Contextual Connection (見えないつながり)**
   - "頭痛は気圧低下のせいです。あなたのせいではありません"
   - "肌の調子は湿度28%が原因。ルーティンは間違っていません"
   - 環境要因と体感を結び、自己責任感を軽減

3. **Micro-Actions (小さな提案)**
   - "1時間のジム" → "3回の深呼吸"
   - "8時間睡眠" → "今夜10分早く布団に入る"
   - 実行可能な最小単位のアクションを提案

### 1.3 ヒューマンバッテリー (The Human Battery)

人間の体力を「スマホのバッテリー」に見立てて可視化します。

- **充電 (Charge):** 睡眠と休息で回復。
- **放電 (Drain):** 活動、ストレス、気象条件で消費。

### 1.4 データ・ナラティブ (The Data Narrative)

Tempo AI は、ユーザーを「数値の集合体」ではなく「見えない力に影響される生きた人間」として捉えます。

#### A. 見えない負荷の可視化 (Invisible Burden Awareness)

- **気圧変動:** 頭痛や倦怠感の隠れた原因として識別
- **湿度低下:** 肌バリア機能低下の環境要因として警告  
- **睡眠債務:** 認知機能低下の予測材料として活用
- **ストレス蓄積:** HRV データから無意識のストレスを検出

#### B. 環境×体調の相関分析

AIは複数のデータレイヤーを重ね合わせ、ユーザーが気づかない因果関係を発見します：

```
例: 「なんとなく調子が悪い」の背景
→ 気圧-3hPa(頭痛要因) + 湿度22%(肌乾燥) + REM睡眠45分(回復不足)
→ AI結論: "今日の不調は天候が主因。あなたの体調管理は間違っていません"
```

### 1.5 コンテキスト・インテリジェンス

「数値」を「文脈」で解釈します。同じ睡眠不足でも、「美容タグ」を選択しているユーザーには肌への影響を、「仕事タグ」のユーザーには集中力への影響を警告します。

---

## 2. オンボーディングフロー (Onboarding Flow)

### 2.1 言語・ウェルカム (Page 0-1)

- 言語選択（🇯🇵/🇺🇸）
- コンセプト提示: "Meet Your Human Battery"（あなたのバッテリーを知ろう）

### 2.2 ユーザーモード選択 (Page 2)

バッテリーの減り方とアドバイスの基準となる「モード」を選択します。

1.  **🍀 Standard Mode (スタンダード)**
    - **目的:** 効率的な日常、メンタルヘルス、疲労回避。
    - **ロジック:** バッテリーは「生活するための残り体力」。無理をさせないアドバイス。
2.  **🏃 Athlete Mode (アスリート)**
    - **目的:** パフォーマンス向上、トレーニング、肉体改造。
    - **ロジック:** バッテリーは「トレーニングの燃料」。負荷と回復のバランスを重視。

### 2.3 フォーカスタグ選択 (Page 3)

ユーザーの関心事（複数選択可）を設定し、AI の視点をカスタマイズします。

- **🧠 Deep Focus (Work):** 仕事、集中力、脳疲労。
- **✨ Beauty & Skin:** 肌のコンディション、水分量、睡眠ホルモン。
- **🥗 Diet & Metabolism:** 食事タイミング、代謝、カロリー収支。
- **🍃 Chill / Relax:** 自律神経バランス、入浴、サウナ、リセット。

### 2.4 データ連携許可 (Page 4-5)

- **HealthKit:** 心拍数、睡眠、歩数など（バッテリー計算の核）。
- **Location:** Open-Meteo API による気象・気圧データの取得（頭痛予報や発汗量予測に必須）。

---

## 3. ホーム画面: デジタル・コックピット (The Digital Cockpit)

### 3.1 [Top] 今日のヘッドライン (Daily Headline)

- **UI:** 雑誌のタイトルのような大きなタイポグラフィ。
- **機能:** AI が生成した「今日の一言結論」。
  - _例:_ **"Low Pressure Warning"** (気圧低下注意)
  - _例:_ **"Go for Personal Best"** (自己ベストを狙え)
- **インタラクション:** タップすると「なぜその結論なのか」の詳細分析画面へ遷移。

### 3.2 [Middle] リキッド・バッテリー (Liquid Battery)

- **UI:** 液体が揺らめくアニメーション付きのバッテリーゲージ。
- **カラー:** 残量に応じてネオンカラーが変化（緑 → 黄 → 赤）。
- **サブ情報:** 「夕方までもつ予測です」等のショートコメント。

### 3.3 [Lower Middle] 直感的な指標 (Intuitive Cards)

3 つのステータスカードを表示。タップで詳細へドリルダウン。

1.  **Stress Level (Internal Load):**
    - HRV（心拍変動）と安静時心拍数から算出。
    - 「ストレス」として可視化（高ストレス＝警告色）。
2.  **Recovery:**
    - 前日の負荷と睡眠の質から算出された回復度。
3.  **Context Metric:**
    - _Standard:_ 歩数 / 活動ゴール。
    - _Athlete:_ Exertion（運動強度） / Strain。

### 3.4 [Bottom] スマートサジェスト (Smart Suggestions)

特定の条件（タグ × データ）が揃った時のみ出現するミニカード。

- _例 (Beauty タグ + 湿度低下):_ 「乾燥注意報: 保湿を強化してください」
- _例 (Chill タグ + 高ストレス):_ 「サウナチャンス: 交感神経が高ぶっています」

---

## 4. ロジックとデータ処理 (Logic & Data Processing)

### 4.1 ハイブリッド処理アーキテクチャ (Hybrid Processing Architecture)

Tempo AI は**「瞬時性」と「深い洞察」を両立**するため、静的処理とAI分析を戦略的に使い分けます。

#### A. Static Logic (瞬時表示 - 0.5秒以内)
- **バッテリー計算:** リアルタイム必須のため、デバイス内で即座に算出
- **カラーコーディング:** 緑→黄→赤の状態表示を即座に反映
- **天気アイコン:** Open-MeteoのweatherCodeをSFSymbolsに直接変換

#### B. AI Analysis (高付加価値 - 2秒以内)
- **ヘッドライン生成:** 複数要因の統合分析（天気×体調×タグ）
- **コンテキスト洞察:** 環境要因と体感の因果関係発見
- **パーソナライズド提案:** ユーザーの状況に特化したマイクロアクション

#### C. キャッシュ戦略 (Cost Optimization)
```
Layer 1: 1時間キャッシュ (頻繁なアプリ使用に対応)
Layer 2: 4時間キャッシュ (類似コンテキストの再利用)  
Layer 3: 静的フォールバック (オフライン・エラー時)
```

### 4.2 バッテリーエンジン (Battery Engine)

- **初期充電量:** (睡眠時間スコア × 0.5) + (睡眠の質スコア × 0.3) + (HRV ベースライン比 × 0.2)
- **放電係数:**
  - 基本代謝 + アクティブカロリー
  - ストレス負荷（HRV 低下時間）
  - 環境負荷（高温、低気圧時は減りが早くなる）

### 4.3 AI プロンプト・インジェクション (Contextual AI Prompting)

Cloudflare Workers 上で、ユーザー設定に基づいてプロンプトを動的に構築します。

#### A. システムペルソナ（AI の性格設定）

```
"あなたはTempo、深い共感力と科学的知識を持つヘルスパートナーです。
ユーザーを理解し、検証し、力を与えることが最重要の目標です。

核心原則:
1. データが悪くても決してユーザーを叱らない
2. 問題を指摘する代わりに「回復戦略」を提供する  
3. 結論（ヘッドライン）から始める
4. 見えない環境要因とユーザーの感覚をつなげる
5. 休息の許可 OR 挑戦への励まし（罪悪感は与えない）

あなたは医師ではなく、ユーザーが見えないパターンを見る賢い友人です。"
```

#### B. 動的タグインジェクション

- **Base Prompt:** 選択されたモード（Standard/Athlete）に基づく基本方針
- **Tag-Specific Lens:** 各タグに対応する分析視点を動的に追加
  - **Work Lens:** "REM睡眠と気圧変動を分析し、脳フォグリスクを予測"
  - **Beauty Lens:** "深い睡眠と湿度レベルを分析し、肌バリア状態を評価"  
  - **Athlete Lens:** "HRVと気温を分析し、トレーニング適性を判定"

#### C. 衝突解決ロジック

- **生物学的安全性優先:** バッテリー残量 < 20% なら全タグを無効化し休息を指示
- **統合的アプローチ:** 複数タグ選択時は「両方に良い選択」を優先提案
- **タイミング認識:** 時間帯を考慮した優先順位調整（朝：活動系、夜：回復系）

### 4.4 外部データ統合 (Open-Meteo)

- **取得データ:** 気温、湿度、体感温度、**気圧（Surface Pressure）**、天気コード。
- **活用:**
  - 気圧急低下 → 「頭痛リスク」としてアドバイスに反映。
  - 高温多湿 → 「熱中症リスク」としてバッテリー減少率に反映。

---

## 5. 詳細画面とパーソナライゼーション (Detailed Views)

### 5.1 データ・ドリルダウン

ホーム画面の各要素をタップすると表示される詳細画面も、タグによって内容が変化します。

- **睡眠詳細 (Sleep Detail):**
  - _通常:_ 睡眠ステージグラフ。
  - _Beauty タグ:_ 「肌のゴールデンタイム（深い睡眠）」の評価を追加。
  - _Work タグ:_ 「脳の回復度（REM 睡眠）」の評価を追加。
- **ストレス詳細 (Stress Detail):**
  - _通常:_ HRV トレンド。
  - _Chill タグ:_ 「自律神経バランス」として表示し、推奨入浴法（温度・時間）を提案。

### 5.2 バイタル・グリッド (Vital Grid)

分析不要なユーザー向けに、最下部に生データを横スクロールで表示。

- 歩数、心拍数、呼吸数、体温、血中酸素ウェルネス。

---

## 6. プライバシーとセキュリティ (Privacy & Security)

### 6.1 データ保護

- **オンデバイス処理:** HealthKit の生データは可能な限りデバイス内で一次処理（平均化など）を行う。
- **匿名化:** AI（Claude）へ送信するデータには、個人を特定できる情報（名前、詳細な位置座標）は含めない。位置情報は天気取得のために「市町村レベル」の座標のみ使用。

### 6.2 AI透明性 (AI Transparency)

#### A. 分析プロセスの可視化

- **データソース明示:** 「あなたの睡眠データ（HealthKit）と気象情報から分析」
- **根拠の提示:** 「REM睡眠60分未満 + 気圧低下-5hPa = 集中力低下リスク」  
- **信頼度表示:** AI分析の確信度を％で表示（例：「83%の確信度」）

#### B. AI の限界の明確化

```
重要な免責事項:
- この分析はAIによる一般的な健康情報の提供であり、医療的助言ではありません
- 気になる症状がある場合は、医師にご相談ください  
- 個人の健康状態により、推奨内容が適さない場合があります
- AIは常に完璧ではなく、時として間違った分析をする可能性があります
```

#### C. ユーザーコントロール

- **分析レベル調整:** 詳細分析 / 基本分析 / オフの選択可
- **フィードバック機能:** 「この分析は役立ちましたか？」で AI 精度向上
- **データ削除権:** 蓄積された分析履歴をいつでも完全削除可能

### 6.3 透過性

- 何のデータがなぜ必要なのか（例：気圧データは頭痛予測のため）を明示的に説明する。
- **AI分析コスト:** ユーザー1日あたり約10円のAI分析費用が発生することを説明
- **キャッシュ戦略:** 同じ状況では過去の分析を再利用してコストを削減することを明示

---

## 7. テクニカルスタック (Technical Stack)

- **Frontend:** iOS (SwiftUI, HealthKit, CoreLocation, Swift Charts)
- **Backend:** Cloudflare Workers (TypeScript, Hono)
- **AI:** Anthropic Claude 3.5 Sonnet (via API)
- **Weather:** Open-Meteo API (Free/Non-commercial)
- **Architecture:** MVVM + Service Layer Pattern

---

## 8. まとめ (Summary)

### 8.1 ビジョンの進化

Tempo AI Ver 2.0 は、単なる記録ツールから**「共感的AIパートナー」**へと進化します。
「今日のバッテリー残量」という共通言語を通じ、仕事、美容、トレーニングといった個人の文脈に合わせて、最適な生活のテンポを提案します。

### 8.2 コア価値提案

#### A. 見えない現実の可視化
- 気圧変動、湿度低下、睡眠債務など、ユーザーが気づかない「見えない負荷」を特定
- 環境要因と体調の因果関係を明確化し、自己責任感を軽減

#### B. 許可を与える AI
- 「休む権利」「挑戦する許可」を科学的根拠とともに提供
- 義務感や罪悪感ではなく、解放感とエンパワーメントを生み出す

#### C. マイクロアクション志向  
- 「1時間の運動」ではなく「3回の深呼吸」
- 実行ハードルを極限まで下げた、失敗のない提案

### 8.3 技術的優位性

- **ハイブリッド処理:** 瞬時性（静的計算）と洞察力（AI分析）の両立
- **コスト効率:** 1日10円以下のAI分析費用で高品質な個別化を実現  
- **プライバシーファースト:** デバイス内処理とデータ匿名化の徹底

### 8.4 長期的インパクト

Tempo AI は、健康管理アプリの新しい標準を確立します：
- **数値から物語へ:** データの羅列から文脈的な理解への転換
- **批判から共感へ:** ユーザーを責めず、環境要因を理解するAI  
- **複雑から直感へ:** 科学的根拠をシンプルな行動指針に変換

これにより、ユーザーは自分の体と心をより深く理解し、持続可能な健康習慣を身につけることができます。
