# Phase 5: メトリクス詳細画面UI設計書

**フェーズ**: 5 / 14  
**Part**: A（iOS UI）  
**前提フェーズ**: Phase 3（メトリクスカード）

---

## ⚠️ 実装前必読ドキュメント

**実装を開始する前に、以下のドキュメントを必ず確認してください：**

### 📋 必須参考資料
- **[CLAUDE.md](../../CLAUDE.md)** - 開発ガイドライン・基本原則
- **[AI Prompt Design](../ai-prompt-design.md)** - AI設計指針
- **[UI Specification](../ui-spec.md)** - UI設計仕様書
- **[Technical Specification](../technical-spec.md)** - 技術仕様書

### 📱 Swift/iOS専用資料
- **[UX Concepts & Principles](../../.claude/ux_concepts.md)** - UX設計原則
- **[Swift Coding Standards](../../.claude/swift-coding-standards.md)** - Swift開発標準

### ✅ 実装完了後の必須作業
実装完了後は必ず以下を実行してください：
```bash
# リント・フォーマット確認
swiftlint
swift-format --lint --recursive ios/

# テスト実行
swift test
```

---

## このフェーズで実現すること

1. **回復詳細画面**の実装
2. **睡眠詳細画面**の実装
3. **エネルギー詳細画面**の実装
4. **ストレス詳細画面**の実装

---

## 完了条件

- [ ] ホーム画面の各メトリクスカードタップで対応する詳細画面へ遷移
- [ ] 各詳細画面にスコア、グラフ、詳細情報が表示される
- [ ] 戻るボタンでホーム画面へ戻れる
- [ ] 全画面でMockデータが正しく表示される

---

## 画面一覧

| 画面 | 遷移元 | 主なデータソース |
|------|--------|-----------------|
| 回復詳細 | 回復カード | HRV |
| 睡眠詳細 | 睡眠カード | 睡眠データ |
| エネルギー詳細 | エネルギーカード | 歩数、運動データ |
| ストレス詳細 | ストレスカード | HRV、心拍数 |

---

## 共通レイアウト構造

各詳細画面は以下の共通構造を持つ:

```
┌─────────────────────────────────────┐
│ [←] [画面タイトル]                  │ ← ナビゲーションバー
├─────────────────────────────────────┤
│                                     │
│        [スコア表示エリア]            │
│         78%                         │
│         ●●●●○                      │ ← プログレスバー（5つの円）
│         良好                        │
│                                     │
├─────────────────────────────────────┤
│                                     │
│        [グラフエリア]               │
│     （過去7日間のトレンド）          │
│                                     │
├─────────────────────────────────────┤
│                                     │
│        [詳細データエリア]            │
│     （各種数値の詳細表示）           │
│                                     │
├─────────────────────────────────────┤
│                                     │
│        [説明エリア]                 │
│     （この指標の意味の説明）         │
│                                     │
└─────────────────────────────────────┘
```

### プログレスバー（5つの円）

スコアに応じて塗りつぶされる円の数が変化:

| スコア範囲 | 表示 | 状態テキスト例 |
|-----------|------|---------------|
| 0-20% | ●○○○○ | 要注意 |
| 21-40% | ●●○○○ | やや低め |
| 41-60% | ●●●○○ | 普通 |
| 61-80% | ●●●●○ | 良好 |
| 81-100% | ●●●●● | 最高 |

---

## 回復詳細画面

### 画面構成

```
┌─────────────────────────────────────┐
│ [←] 回復                            │
├─────────────────────────────────────┤
│                                     │
│           🔋                        │
│           78%                       │
│         ●●●●○                      │ ← プログレスバー（5つの円）
│           良好                      │
│                                     │
├─────────────────────────────────────┤
│ 過去7日間のトレンド                 │
│ ┌─────────────────────────────┐    │
│ │    ╭─╮                      │    │
│ │  ╭─╯  ╰─╮   ╭─╮            │    │
│ │ ╯        ╰─╯  ╰───         │    │
│ │ 月 火 水 木 金 土 日         │    │
│ └─────────────────────────────┘    │
├─────────────────────────────────────┤
│                                     │
│ 今日のデータ                        │
│                                     │
│ HRV（心拍変動）        72 ms       │
│ 7日平均               68 ms       │
│ 安静時心拍数           52 bpm      │
│ 7日平均               54 bpm      │
│                                     │
├─────────────────────────────────────┤
│                                     │
│ 回復スコアについて                  │
│                                     │
│ HRV（心拍変動）は自律神経のバラ    │
│ ンスを反映し、体の回復状態を示す    │
│ 重要な指標です。数値が高いほど      │
│ 回復が進んでいます。                │
│                                     │
└─────────────────────────────────────┘
```

### データ項目

| 項目 | 単位 | 説明 |
|------|------|------|
| HRV | ms | 今日の心拍変動 |
| HRV 7日平均 | ms | 過去7日間の平均 |
| 安静時心拍数 | bpm | 今朝の安静時心拍数 |
| 安静時心拍数 7日平均 | bpm | 過去7日間の平均 |

---

## 睡眠詳細画面

### 画面構成

```
┌─────────────────────────────────────┐
│ [←] 睡眠                            │
├─────────────────────────────────────┤
│                                     │
│           😴                        │
│           85%                       │
│         ●●●●●                      │ ← プログレスバー（5つの円）
│           最高                      │
│                                     │
├─────────────────────────────────────┤
│ 昨夜の睡眠                          │
│ ┌─────────────────────────────┐    │
│ │ ███████████████████████     │    │ ← 睡眠ステージバー
│ │ 22:30        就寝           │    │
│ │ 6:15         起床           │    │
│ │ 7h 45m       睡眠時間       │    │
│ └─────────────────────────────┘    │
├─────────────────────────────────────┤
│ 睡眠ステージ                        │
│                                     │
│ 深い睡眠          1h 45m  (23%)    │
│ REM睡眠           1h 30m  (19%)    │
│ 浅い睡眠          4h 30m  (58%)    │
│ 中途覚醒          2回              │
│                                     │
├─────────────────────────────────────┤
│ 過去7日間                           │
│                                     │
│ 平均睡眠時間      7h 20m           │
│ 平均就寝時刻      23:15            │
│ 平均起床時刻      6:35             │
│                                     │
├─────────────────────────────────────┤
│                                     │
│ 睡眠スコアについて                  │
│                                     │
│ 睡眠時間、睡眠ステージのバランス、  │
│ 中途覚醒の回数などから総合的に      │
│ 評価しています。                    │
│                                     │
└─────────────────────────────────────┘
```

### データ項目

| 項目 | 単位 | 説明 |
|------|------|------|
| 就寝時刻 | 時刻 | 昨夜の就寝時刻 |
| 起床時刻 | 時刻 | 今朝の起床時刻 |
| 睡眠時間 | 時間 | 総睡眠時間 |
| 深い睡眠 | 時間 | 深い睡眠の時間と割合 |
| REM睡眠 | 時間 | REM睡眠の時間と割合 |
| 浅い睡眠 | 時間 | 浅い睡眠の時間と割合 |
| 中途覚醒 | 回数 | 夜中に目が覚めた回数 |

---

## エネルギー詳細画面

### 画面構成

```
┌─────────────────────────────────────┐
│ [←] エネルギー                      │
├─────────────────────────────────────┤
│                                     │
│           ⚡                        │
│           62%                       │
│         ●●●○○                      │ ← プログレスバー（5つの円）
│           良好                      │
│                                     │
├─────────────────────────────────────┤
│ 過去7日間の活動量                   │
│ ┌─────────────────────────────┐    │
│ │ █ █ █ █ █ █ █               │    │ ← 棒グラフ
│ │ 月 火 水 木 金 土 日         │    │
│ └─────────────────────────────┘    │
├─────────────────────────────────────┤
│ 今日のアクティビティ                │
│                                     │
│ 歩数               8,234 歩        │
│ 目標達成率          82%            │
│ 消費カロリー        2,150 kcal     │
│ アクティブ時間      45 分          │
│                                     │
├─────────────────────────────────────┤
│ 昨日の運動                          │
│                                     │
│ ランニング          30分           │
│ 消費カロリー        320 kcal       │
│                                     │
├─────────────────────────────────────┤
│ 過去7日間                           │
│                                     │
│ 平均歩数            7,850 歩       │
│ 総運動時間          3h 20m         │
│                                     │
└─────────────────────────────────────┘
```

### データ項目

| 項目 | 単位 | 説明 |
|------|------|------|
| 歩数 | 歩 | 今日の歩数 |
| 目標達成率 | % | 歩数目標に対する達成率 |
| 消費カロリー | kcal | 今日の消費カロリー |
| アクティブ時間 | 分 | 活動的だった時間 |
| 運動種目 | - | 昨日の運動の種類 |
| 運動時間 | 分 | 昨日の運動時間 |

---

## ストレス詳細画面

### 画面構成

```
┌─────────────────────────────────────┐
│ [←] ストレス                        │
├─────────────────────────────────────┤
│                                     │
│           🧠                        │
│           45%                       │
│         ●●○○○                      │ ← プログレスバー（5つの円）
│           普通                      │
│                                     │
├─────────────────────────────────────┤
│ 過去7日間のトレンド                 │
│ ┌─────────────────────────────┐    │
│ │    ╭─╮                      │    │
│ │  ╭─╯  ╰─╮   ╭─╮            │    │
│ │ ╯        ╰─╯  ╰───         │    │
│ │ 月 火 水 木 金 土 日         │    │
│ └─────────────────────────────┘    │
├─────────────────────────────────────┤
│ 今日のデータ                        │
│                                     │
│ HRV（心拍変動）        58 ms       │
│ 安静時心拍数           62 bpm      │
│ 日中平均心拍数         78 bpm      │
│                                     │
├─────────────────────────────────────┤
│ 自律神経のバランス                  │
│ ┌─────────────────────────────┐    │
│ │ 交感神経 ████████░░ 75%     │    │
│ │ 副交感   ██████░░░░ 55%     │    │
│ └─────────────────────────────┘    │
├─────────────────────────────────────┤
│                                     │
│ ストレススコアについて              │
│                                     │
│ HRVと心拍数から自律神経のバランス  │
│ を推定しています。スコアが低いほど  │
│ リラックス状態に近いことを示します。│
│                                     │
└─────────────────────────────────────┘
```

### データ項目

| 項目 | 単位 | 説明 |
|------|------|------|
| HRV | ms | 心拍変動 |
| 安静時心拍数 | bpm | 安静時の心拍数 |
| 日中平均心拍数 | bpm | 日中の平均心拍数 |
| 交感神経活動 | % | 交感神経の活性度（推定） |
| 副交感神経活動 | % | 副交感神経の活性度（推定） |

---

## 実装コンポーネント

### Views（Features/Home/Views/）

- `RecoveryDetailView` - 回復詳細画面
- `SleepDetailView` - 睡眠詳細画面
- `EnergyDetailView` - エネルギー詳細画面
- `StressDetailView` - ストレス詳細画面

### Shared Components

- `ScoreCircle` - スコア表示（大きな数字 + 状態テキスト）
- `TrendLineChart` - 折れ線グラフ（7日間トレンド）
- `TrendBarChart` - 棒グラフ（活動量など）
- `DataRow` - データ項目の行（ラベル + 値）
- `SleepStageBar` - 睡眠ステージのバー表示

---

## グラフ表示

### グラフの種類

| 画面 | グラフ種類 | 用途 |
|------|-----------|------|
| 回復 | 折れ線 | HRVの7日間推移 |
| 睡眠 | ステージバー | 睡眠ステージの内訳 |
| エネルギー | 棒グラフ | 歩数の7日間推移 |
| ストレス | 折れ線 | ストレススコアの7日間推移 |

### グラフライブラリ

- Swift Charts（iOS 16+）を使用
- または独自実装（シンプルなグラフなら）

### Mockグラフデータ

7日分のサンプルデータを用意:

```
回復（HRV）: [65, 68, 72, 70, 58, 62, 72]
睡眠時間:   [7.5, 6.8, 7.2, 7.0, 6.5, 8.0, 7.75]
歩数:      [8200, 7500, 9100, 6800, 7200, 10500, 8234]
ストレス:  [45, 52, 48, 55, 62, 50, 45]
```

---

## Mockデータ

### 回復Mock

```
recovery:
  score: 78
  status: "良好"
  hrv: 72
  hrvAvg7d: 68
  restingHR: 52
  restingHRAvg7d: 54
  trend: [65, 68, 72, 70, 58, 62, 72]
```

### 睡眠Mock

```
sleep:
  score: 85
  status: "最高"
  bedtime: "22:30"
  wakeTime: "6:15"
  duration: 7.75
  deepSleep: 1.75
  remSleep: 1.5
  lightSleep: 4.5
  awakenings: 2
  avgDuration7d: 7.33
  avgBedtime7d: "23:15"
  avgWakeTime7d: "6:35"
```

### エネルギーMock

```
energy:
  score: 62
  status: "良好"
  steps: 8234
  stepGoal: 10000
  calories: 2150
  activeMinutes: 45
  yesterdayWorkout: "ランニング"
  yesterdayWorkoutMinutes: 30
  yesterdayWorkoutCalories: 320
  avgSteps7d: 7850
  totalWorkoutTime7d: 200
```

### ストレスMock

```
stress:
  score: 45
  status: "普通"
  hrv: 58
  restingHR: 62
  avgHRDaytime: 78
  sympathetic: 75
  parasympathetic: 55
  trend: [45, 52, 48, 55, 62, 50, 45]
```

---

## カラー適用

| 要素 | カラー |
|------|--------|
| スコア（高） | Primary Color または 緑系 |
| スコア（普通） | 黄色系 |
| スコア（低） | オレンジ系 |
| グラフライン | Primary Color |
| グラフバー | Primary Color |
| 睡眠ステージ（深い） | 濃い青紫 |
| 睡眠ステージ（REM） | 青 |
| 睡眠ステージ（浅い） | 水色 |

---

## UI/UXポイント

### スコア表示

- 大きく中央に配置
- 一目でコンディションが分かる

### グラフ

- シンプルで見やすく
- 7日間という期間が直感的に分かる
- 今日のデータ点は強調表示

### 詳細データ

- ラベルと値が対になっていて見やすく
- 7日平均との比較で「今日の状態」が分かる

---

## 関連ドキュメント

- `ui-spec.md` - セクション7「詳細画面群」（3-2〜3-5）
- `technical-spec.md` - セクション2.3「データモデル」（HealthData）

---

## 改訂履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0 | 2025-12-10 | 初版作成 |
