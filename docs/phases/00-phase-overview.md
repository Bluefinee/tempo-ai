# Tempo AI 開発フェーズ管理書

**バージョン**: 2.0  
**作成日**: 2025 年 12 月 10 日  
**最終更新日**: 2025 年 12 月 11 日

---

## 概要

本ドキュメントは、Tempo AI の開発を 17 のフェーズに分割し、各フェーズの目的・成果物・依存関係を管理するものです。

**v2.0 での主な変更点**:

- コンディション画面を通常モードに含め、Phase 5 として新設
- タブバーを最初から 3 タブ構成（ホーム / コンディション / 設定）に変更
- トラベルモードを Phase 16-17 として通常モード完成後に追加
- 全体フェーズ数を 14→17 に拡張

---

## ⚠️ 重要：全フェーズ共通の要件

### 📋 実装前の必須確認事項

**各フェーズの実装を開始する前に、必ず以下のドキュメントを確認してください：**

**全フェーズ共通**:

- **[CLAUDE.md](../../CLAUDE.md)** - 開発ガイドライン・基本原則
- **[AI Prompt Design](../ai-prompt-design.md)** - AI 設計指針
- **[UI Specification](../ui-spec.md)** - UI 設計仕様書
- **[Technical Specification](../technical-spec.md)** - 技術仕様書

**Swift/iOS フェーズ (1-6, 11-17)**:

- **[UX Concepts & Principles](../../.claude/ux_concepts.md)** - UX 設計原則
- **[Swift Coding Standards](../../.claude/swift-coding-standards.md)** - Swift 開発標準

**Backend フェーズ (7-10, 11-17)**:

- **[TypeScript Hono Standards](../../.claude/typescript-hono-standards.md)** - TypeScript + Hono 開発標準

**コンディション画面・トラベルモード関連 (5, 16-17)**:

- **[Travel Mode & Condition Spec](../travel-mode-condition-spec.md)** - トラベルモード・コンディション画面設計

### ✅ 実装完了後の必須作業

**各フェーズの実装完了後は、必ず以下の品質チェックを実行してください：**

**Swift/iOS 側** (該当フェーズ):

```bash
# リント・フォーマット確認
swiftlint
swift-format --lint --recursive ios/

# テスト実行
swift test
```

**Backend 側** (該当フェーズ):

```bash
# TypeScript型チェック
npm run typecheck

# リント・フォーマット確認
npm run lint

# テスト実行
npm test
```

これらのチェックがすべて通ることを CI 通過の前提条件とします。

---

## 全体構成

| Part                  | フェーズ              | 概要                          |
| --------------------- | --------------------- | ----------------------------- |
| **A: iOS UI**         | Phase 1〜6 (5.5 含む) | Mock データを使用した UI 実装 |
| **B: Backend**        | Phase 7〜10           | API・外部サービス統合         |
| **C: 結合**           | Phase 11〜13          | UI と API の接続、状態管理    |
| **D: 仕上げ**         | Phase 14〜15          | エラー処理、ポリッシュ        |
| **E: トラベルモード** | Phase 16〜17          | トラベルモード機能追加        |

---

## 並行開発について

Part A（iOS UI）と Part B（Backend）は並行開発が可能です。

```
Part A (iOS)          Part B (Backend)
    │                      │
Phase 1 ──────────────── Phase 7
    │                      │
Phase 2 ──────────────── Phase 8
    │                      │
Phase 3 ──────────────── Phase 9
    │                      │
Phase 4 ──────────────── Phase 10
    │                      │
Phase 5                    │
    │                      │
Phase 5.5                  │
    │                      │
Phase 6                    │
    └──────────┬───────────┘
               │
         Part C (結合)
         Phase 11〜13
               │
         Part D (仕上げ)
         Phase 14〜15
               │
    ───────────────────────
    ↑ 通常モード完成ライン ↑
    ───────────────────────
               │
         Part E (トラベルモード)
         Phase 16〜17
```

Git Worktree を使用して、iOS と Backend を同時に進めることを想定しています。

---

## Part A: iOS UI（Mock データ使用）

### Phase 1: オンボーディング

**目的**: ユーザーの初回起動体験を完成させる

**スコープ**:

- オンボーディング全 7 画面
- HealthKitManager（権限リクエスト + データ取得）
- LocationManager（権限リクエスト + 位置取得）
- UserDefaults へのプロフィール保存
- テストデータ生成（DEBUG 用）

**成果物**:

- オンボーディングフロー完動
- シミュレータで HealthKit テストデータを使った動作確認が可能

**設計書**: `01-phase-onboarding.md`

---

### Phase 2: ホーム画面 UI（基本構造）

**目的**: メイン画面の骨格を作る

**スコープ**:

- ヘッダー（日付、挨拶）
- アドバイスサマリーカード
- **タブバー（ホーム / コンディション / 設定）** ← 最初から 3 タブ

**成果物**:

- Mock データでホーム画面が表示される
- タブ切り替えが動作する

**設計書**: `02-phase-home-basic.md`

**注意**: タブバーは最初から 3 タブ構成で実装する

---

### Phase 3: ホーム画面 UI（メトリクス・トライ）

**目的**: ホーム画面の全要素を揃える

**スコープ**:

- **コンディションサマリーカード**（4 指標：回復・睡眠・エネルギー・ストレス）
- 今日のトライカード
- 今週のトライカード
- 追加アドバイス（フローティング吹き出し）

**成果物**:

- ホーム画面の全 UI コンポーネントが揃う
- 月曜日の今週のトライ表示切り替え
- コンディションサマリーカードタップでコンディション画面（Phase 5）へ遷移準備

**設計書**: `03-phase-home-metrics.md`

**変更点**: 旧「メトリクスカード」を「コンディションサマリーカード」に名称変更

---

### Phase 4: 詳細画面 UI

**目的**: アドバイス・トライの詳細表示

**スコープ**:

- アドバイス詳細画面
- 今日のトライ詳細画面
- 今週のトライ詳細画面
- 画面遷移アニメーション

**成果物**:

- ホーム画面からタップで詳細画面へ遷移
- 詳細画面から戻る動作

**設計書**: `04-phase-detail-screens.md`

**変更点**: 旧「メトリクス詳細画面」は Phase 5（コンディション画面）に移動

---

### Phase 5: コンディショントップ画面 UI

**目的**: 健康状態を俯瞰するダッシュボードの骨格を作る

**スコープ**:

- コンディショントップ画面（5 セクションのダッシュボード）
- 各セクションカード（サマリー表示）
- 期間セレクター（今日/今週/今月）
- 詳細画面への遷移準備

**成果物**:

- タブバーからコンディショントップ画面にアクセス可能
- 5 セクションのサマリーが表示される
- 期間切り替えが動作する

**設計書**: `05-phase-condition-top.md`

---

### Phase 5.5: コンディション詳細画面群

**目的**: 各セクションの詳細表示と分析ロジック

**スコープ**:

- サーカディアンリズム詳細画面
- HRV 詳細画面
- 睡眠詳細画面
- 活動量詳細画面
- 環境詳細画面
- リズム安定度スコアの算出ロジック
- ヒントの条件分岐ロジック
- 週間トレンドグラフ共通コンポーネント

**成果物**:

- コンディショントップから各詳細画面へ遷移
- リズム安定度スコアが正しく算出・表示
- 条件に応じたヒントが表示される
- 週間トレンドグラフが表示される

**設計書**: `055-phase-condition-detail.md`

---

### Phase 6: 設定画面 UI

**目的**: ユーザー設定の編集機能

**スコープ**:

- 設定トップ画面
- プロフィール編集画面
- 関心ごとタグ編集画面
- データとプライバシー画面
- アプリについて画面

**成果物**:

- 設定からプロフィール・タグを編集可能
- UserDefaults への保存

**設計書**: `06-phase-settings.md`

---

## Part B: バックエンド

### Phase 7: Backend 基盤

**目的**: API の骨格を作り、iOS との疎通を確認する

**スコープ**:

- Hono Router セットアップ
- `/api/advice` エンドポイント（固定 JSON）
- 型定義（リクエスト・レスポンス）
- iOS APIClient 実装・疎通確認

**成果物**:

- iOS から Backend へリクエストが通る
- 固定 JSON が返却される

**設計書**: `07-phase-backend-foundation.md`

---

### Phase 8: 外部 API 統合

**目的**: 気象・大気汚染データの取得

**スコープ**:

- Open-Meteo Weather API 統合
- Open-Meteo Air Quality API 統合
- フォールバック処理

**成果物**:

- 位置情報から気象データを取得
- API 失敗時のフォールバック動作

**設計書**: `08-phase-external-api.md`

---

### Phase 9: Claude API 統合

**目的**: AI によるアドバイス生成

**スコープ**:

- プロンプト構造（Layer 1〜3）
- Claude Sonnet 呼び出し（メインアドバイス）
- Claude Haiku 呼び出し（追加アドバイス）
- Prompt Caching 設定
- JSON パース

**成果物**:

- 実際のパーソナライズドアドバイスが生成される

**設計書**: `09-phase-claude-api.md`

---

### Phase 10: コンディションデータ API（新規）

**目的**: コンディション画面用のデータ取得・算出

**スコープ**:

- リズム安定度スコア算出エンドポイント（または iOS 側ローカル算出）
- 週間トレンドデータの整形
- 環境データの拡張（気圧トレンドなど）

**成果物**:

- コンディション画面に必要なデータがすべて取得可能

**設計書**: `10-phase-condition-api.md`

---

## Part C: 結合・調整

### Phase 11: UI 結合・調整

**目的**: Mock を実 API に置き換え、UI を調整する

**スコープ**:

- Mock データ削除
- 実 API レスポンスとの接続
- レイアウト調整（文長変動への対応）
- データバインディング確認

**成果物**:

- 全画面が実 API データで動作する
- 文長の変動に対応した UI

**設計書**: `11-phase-integration.md`

---

### Phase 12: キャッシュ・状態管理

**目的**: キャッシュとオフライン対応

**スコープ**:

- CacheManager 実装
- 時間帯判定ロジック（朝・昼・夕）
- 同日キャッシュ
- オフラインフォールバック

**成果物**:

- 同日 2 回目の起動でキャッシュが使われる
- オフライン時に前日のアドバイスが表示される

**設計書**: `12-phase-cache.md`

---

### Phase 13: 追加機能結合

**目的**: 追加アドバイス・トライ履歴の完成

**スコープ**:

- 追加アドバイス生成・表示（昼・夕）
- 今日のトライ履歴管理（重複防止）
- 今週のトライ（月曜判定）

**成果物**:

- 13 時以降、18 時以降に追加アドバイスが表示
- 過去 2 週間と被らないトライが提案される

**設計書**: `13-phase-additional-features.md`

---

## Part D: 仕上げ

### Phase 14: エラーハンドリング

**目的**: エッジケースへの対応

**スコープ**:

- エラー画面 UI（オフライン、データ不足、位置情報失敗）
- 都市手動選択ダイアログ
- エラー状態の伝播

**成果物**:

- 各種エラー時に適切な画面が表示される
- ユーザーが次のアクションを取れる

**設計書**: `14-phase-error-handling.md`

---

### Phase 15: ポリッシュ

**目的**: UX の仕上げ

**スコープ**:

- ローディング表示（0.4 秒ルール）
- アニメーション・マイクロインタラクション
- 最終調整

**成果物**:

- **通常モード完成（MVP 品質）**

**設計書**: `15-phase-polish.md`

---

## ═══════════════════════════════════════

## 通常モード完成ライン（Phase 15 完了時点）

## ═══════════════════════════════════════

---

## Part E: トラベルモード

### Phase 16: トラベルモード基盤

**目的**: トラベルモードの基本機能を実装

**スコープ**:

- トラベルモードの ON/OFF トグル（設定画面 + ホーム画面ヘッダー）
- オンボーディングに拠点（ホームロケーション）設定を追加
- ロケーション管理（Home/Current/Previous）
- LocationHistory データ構造
- 同じ場所に 7 日滞在で Previous クリア

**成果物**:

- トラベルモードを ON/OFF できる
- 拠点が設定・保存される
- ロケーション履歴が管理される

**設計書**: `16-phase-travel-mode-foundation.md`

---

### Phase 17: トラベルモード UI・AI

**目的**: トラベルモード時の UI 変化と AI 対応

**スコープ**:

- ホーム画面の変化（トラベルモード ON 時）
  - アドバイス構造の変化（リズムのずれ + 光/CT/カフェイン）
  - 「適応の目安」セクション
- コンディション画面の変化
  - 環境差分セクション追加
  - サーカディアンリズム詳細に「今日のリセットポイント」追加
- 環境差分詳細画面（新規）
- AI プロンプトの分岐（トラベルコンテキスト追加）
- リセットポイントの算出ロジック

**成果物**:

- トラベルモード ON 時にアドバイスがサーカディアンリズム調整中心に変化
- 環境差分が表示される
- リセットポイントが表示される
- **トラベルモード完成**

**設計書**: `17-phase-travel-mode-ui-ai.md`

---

## 依存関係

```
Phase 1  ← 独立
Phase 2  ← Phase 1（オンボーディング完了後にホームへ遷移）
Phase 3  ← Phase 2
Phase 4  ← Phase 2, 3
Phase 5  ← Phase 2（タブバー）, Phase 3（コンディションサマリーカード）
Phase 5.5← Phase 5（コンディショントップ画面）
Phase 6  ← Phase 2（タブバー）

Phase 7  ← 独立
Phase 8  ← Phase 7
Phase 9  ← Phase 7, 8
Phase 10 ← Phase 7, 8（コンディションデータ用）

Phase 11 ← Phase 1〜6（5.5含む）, Phase 7〜10（全て完了後）
Phase 12 ← Phase 11
Phase 13 ← Phase 11, 12

Phase 14 ← Phase 11
Phase 15 ← Phase 11〜14

─── 通常モード完成 ───

Phase 16 ← Phase 15（通常モード完成後）
Phase 17 ← Phase 16
```

---

## 関連ドキュメント

| ドキュメント                    | 内容                                     |
| ------------------------------- | ---------------------------------------- |
| `product-spec.md`               | プロダクト仕様書                         |
| `technical-spec.md`             | 技術仕様書                               |
| `ui-spec.md`                    | UI/UX 仕様書                             |
| `ai-prompt-design.md`           | AI プロンプト設計書                      |
| `travel-mode-condition-spec.md` | トラベルモード・コンディション画面設計書 |

---

## 改訂履歴

| バージョン | 日付       | 変更内容                                                                                                                                 |
| ---------- | ---------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| 1.0        | 2025-12-10 | 初版作成                                                                                                                                 |
| 2.0        | 2025-12-11 | コンディション画面を Phase 5 として追加、タブバーを 3 タブに変更、トラベルモードを Phase 16-17 として追加、全体フェーズ数を 14→17 に拡張 |
| 2.1        | 2025-12-11 | Phase 5 を Phase 5（トップ画面）と Phase 5.5（詳細画面群）に分割                                                                         |
